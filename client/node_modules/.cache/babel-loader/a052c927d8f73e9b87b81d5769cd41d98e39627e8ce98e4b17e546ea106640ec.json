{"ast":null,"code":"import axios from 'axios';\nconst normalizeCartItems = items => Array.isArray(items) ? items.map(item => {\n  var _ref2, _item$unitPrice, _item$pricingLabel, _ref3, _item$pricingType, _ref4, _item$product_image, _ref5, _item$product_price;\n  const resolveBasePrice = () => {\n    var _ref, _item$basePrice;\n    const raw = (_ref = (_item$basePrice = item.basePrice) !== null && _item$basePrice !== void 0 ? _item$basePrice : item.base_price) !== null && _ref !== void 0 ? _ref : item.pricingType === 'cashPromo' || item.pricing_type === 'cashPromo' ? item.price_cash : item.pricingType === 'installmentPromo' || item.pricing_type === 'installmentPromo' ? item.price_installment : null;\n    if (raw == null) {\n      return null;\n    }\n    const parsed = Number(raw);\n    return Number.isFinite(parsed) ? parsed : null;\n  };\n  return {\n    ...item,\n    quantity: Number(item.quantity) || 0,\n    unitPrice: Number((_ref2 = (_item$unitPrice = item.unitPrice) !== null && _item$unitPrice !== void 0 ? _item$unitPrice : item.unit_price) !== null && _ref2 !== void 0 ? _ref2 : 0) || 0,\n    pricingLabel: (_item$pricingLabel = item.pricingLabel) !== null && _item$pricingLabel !== void 0 ? _item$pricingLabel : '',\n    pricingType: (_ref3 = (_item$pricingType = item.pricingType) !== null && _item$pricingType !== void 0 ? _item$pricingType : item.pricing_type) !== null && _ref3 !== void 0 ? _ref3 : 'cash',\n    product_id: item.product_id,\n    product_name: item.product_name,\n    product_image: (_ref4 = (_item$product_image = item.product_image) !== null && _item$product_image !== void 0 ? _item$product_image : item.productImage) !== null && _ref4 !== void 0 ? _ref4 : '',\n    product_images: Array.isArray(item.product_images) ? item.product_images.map(img => img == null ? '' : String(img).trim()).filter(Boolean) : item.product_image ? [String(item.product_image).trim()] : [],\n    product_price: Number((_ref5 = (_item$product_price = item.product_price) !== null && _item$product_price !== void 0 ? _item$product_price : item.unitPrice) !== null && _ref5 !== void 0 ? _ref5 : 0) || 0,\n    basePrice: resolveBasePrice()\n  };\n}) : [];\nconst handleCartError = error => {\n  if (error !== null && error !== void 0 && error.response && (error.response.status === 401 || error.response.status === 403)) {\n    return {\n      items: [],\n      unauthorized: true\n    };\n  }\n  console.error('Cart API error:', error);\n  return {\n    items: [],\n    error: true\n  };\n};\nexport const calculateCartCount = items => Array.isArray(items) ? items.reduce((sum, item) => sum + (Number(item.quantity) || 0), 0) : 0;\nexport const notifyCartUpdate = (items, {\n  silent = false\n} = {}) => {\n  const count = calculateCartCount(items);\n  window.dispatchEvent(new CustomEvent('cartUpdated', {\n    detail: {\n      count,\n      silent\n    }\n  }));\n};\nexport const fetchCartItems = async () => {\n  try {\n    const {\n      data\n    } = await axios.get('/api/cart');\n    return {\n      items: normalizeCartItems(data === null || data === void 0 ? void 0 : data.items),\n      unauthorized: false\n    };\n  } catch (error) {\n    return handleCartError(error);\n  }\n};\nexport const upsertCartItem = async payload => {\n  try {\n    const {\n      data\n    } = await axios.put('/api/cart/items', payload);\n    return {\n      items: normalizeCartItems(data === null || data === void 0 ? void 0 : data.items),\n      unauthorized: false\n    };\n  } catch (error) {\n    return handleCartError(error);\n  }\n};\nexport const deleteCartItem = async payload => {\n  try {\n    const {\n      data\n    } = await axios.delete('/api/cart/items', {\n      data: payload\n    });\n    return {\n      items: normalizeCartItems(data === null || data === void 0 ? void 0 : data.items),\n      unauthorized: false\n    };\n  } catch (error) {\n    return handleCartError(error);\n  }\n};\nexport const clearCart = async () => {\n  try {\n    const {\n      data\n    } = await axios.delete('/api/cart');\n    return {\n      items: normalizeCartItems(data === null || data === void 0 ? void 0 : data.items),\n      unauthorized: false\n    };\n  } catch (error) {\n    return handleCartError(error);\n  }\n};","map":{"version":3,"names":["axios","normalizeCartItems","items","Array","isArray","map","item","_ref2","_item$unitPrice","_item$pricingLabel","_ref3","_item$pricingType","_ref4","_item$product_image","_ref5","_item$product_price","resolveBasePrice","_ref","_item$basePrice","raw","basePrice","base_price","pricingType","pricing_type","price_cash","price_installment","parsed","Number","isFinite","quantity","unitPrice","unit_price","pricingLabel","product_id","product_name","product_image","productImage","product_images","img","String","trim","filter","Boolean","product_price","handleCartError","error","response","status","unauthorized","console","calculateCartCount","reduce","sum","notifyCartUpdate","silent","count","window","dispatchEvent","CustomEvent","detail","fetchCartItems","data","get","upsertCartItem","payload","put","deleteCartItem","delete","clearCart"],"sources":["D:/xampp/htdocs/Website_Sangswang/client/src/utils/cartApi.js"],"sourcesContent":["import axios from 'axios';\n\nconst normalizeCartItems = (items) =>\n  Array.isArray(items)\n    ? items.map((item) => {\n        const resolveBasePrice = () => {\n          const raw =\n            item.basePrice ??\n            item.base_price ??\n            (item.pricingType === 'cashPromo' || item.pricing_type === 'cashPromo'\n              ? item.price_cash\n              : item.pricingType === 'installmentPromo' || item.pricing_type === 'installmentPromo'\n              ? item.price_installment\n              : null);\n          if (raw == null) {\n            return null;\n          }\n          const parsed = Number(raw);\n          return Number.isFinite(parsed) ? parsed : null;\n        };\n\n        return {\n          ...item,\n          quantity: Number(item.quantity) || 0,\n          unitPrice: Number(item.unitPrice ?? item.unit_price ?? 0) || 0,\n          pricingLabel: item.pricingLabel ?? '',\n          pricingType: item.pricingType ?? item.pricing_type ?? 'cash',\n          product_id: item.product_id,\n          product_name: item.product_name,\n        product_image: item.product_image ?? item.productImage ?? '',\n        product_images: Array.isArray(item.product_images)\n          ? item.product_images\n              .map((img) => (img == null ? '' : String(img).trim()))\n              .filter(Boolean)\n          : item.product_image\n          ? [String(item.product_image).trim()]\n          : [],\n          product_price: Number(item.product_price ?? item.unitPrice ?? 0) || 0,\n          basePrice: resolveBasePrice()\n        };\n      })\n    : [];\n\nconst handleCartError = (error) => {\n  if (error?.response && (error.response.status === 401 || error.response.status === 403)) {\n    return { items: [], unauthorized: true };\n  }\n  console.error('Cart API error:', error);\n  return { items: [], error: true };\n};\n\nexport const calculateCartCount = (items) =>\n  Array.isArray(items)\n    ? items.reduce((sum, item) => sum + (Number(item.quantity) || 0), 0)\n    : 0;\n\nexport const notifyCartUpdate = (items, { silent = false } = {}) => {\n  const count = calculateCartCount(items);\n  window.dispatchEvent(\n    new CustomEvent('cartUpdated', {\n      detail: { count, silent }\n    })\n  );\n};\n\nexport const fetchCartItems = async () => {\n  try {\n    const { data } = await axios.get('/api/cart');\n    return { items: normalizeCartItems(data?.items), unauthorized: false };\n  } catch (error) {\n    return handleCartError(error);\n  }\n};\n\nexport const upsertCartItem = async (payload) => {\n  try {\n    const { data } = await axios.put('/api/cart/items', payload);\n    return { items: normalizeCartItems(data?.items), unauthorized: false };\n  } catch (error) {\n    return handleCartError(error);\n  }\n};\n\nexport const deleteCartItem = async (payload) => {\n  try {\n    const { data } = await axios.delete('/api/cart/items', { data: payload });\n    return { items: normalizeCartItems(data?.items), unauthorized: false };\n  } catch (error) {\n    return handleCartError(error);\n  }\n};\n\nexport const clearCart = async () => {\n  try {\n    const { data } = await axios.delete('/api/cart');\n    return { items: normalizeCartItems(data?.items), unauthorized: false };\n  } catch (error) {\n    return handleCartError(error);\n  }\n};\n\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,kBAAkB,GAAIC,KAAK,IAC/BC,KAAK,CAACC,OAAO,CAACF,KAAK,CAAC,GAChBA,KAAK,CAACG,GAAG,CAAEC,IAAI,IAAK;EAAA,IAAAC,KAAA,EAAAC,eAAA,EAAAC,kBAAA,EAAAC,KAAA,EAAAC,iBAAA,EAAAC,KAAA,EAAAC,mBAAA,EAAAC,KAAA,EAAAC,mBAAA;EAClB,MAAMC,gBAAgB,GAAGA,CAAA,KAAM;IAAA,IAAAC,IAAA,EAAAC,eAAA;IAC7B,MAAMC,GAAG,IAAAF,IAAA,IAAAC,eAAA,GACPZ,IAAI,CAACc,SAAS,cAAAF,eAAA,cAAAA,eAAA,GACdZ,IAAI,CAACe,UAAU,cAAAJ,IAAA,cAAAA,IAAA,GACdX,IAAI,CAACgB,WAAW,KAAK,WAAW,IAAIhB,IAAI,CAACiB,YAAY,KAAK,WAAW,GAClEjB,IAAI,CAACkB,UAAU,GACflB,IAAI,CAACgB,WAAW,KAAK,kBAAkB,IAAIhB,IAAI,CAACiB,YAAY,KAAK,kBAAkB,GACnFjB,IAAI,CAACmB,iBAAiB,GACtB,IAAK;IACX,IAAIN,GAAG,IAAI,IAAI,EAAE;MACf,OAAO,IAAI;IACb;IACA,MAAMO,MAAM,GAAGC,MAAM,CAACR,GAAG,CAAC;IAC1B,OAAOQ,MAAM,CAACC,QAAQ,CAACF,MAAM,CAAC,GAAGA,MAAM,GAAG,IAAI;EAChD,CAAC;EAED,OAAO;IACL,GAAGpB,IAAI;IACPuB,QAAQ,EAAEF,MAAM,CAACrB,IAAI,CAACuB,QAAQ,CAAC,IAAI,CAAC;IACpCC,SAAS,EAAEH,MAAM,EAAApB,KAAA,IAAAC,eAAA,GAACF,IAAI,CAACwB,SAAS,cAAAtB,eAAA,cAAAA,eAAA,GAAIF,IAAI,CAACyB,UAAU,cAAAxB,KAAA,cAAAA,KAAA,GAAI,CAAC,CAAC,IAAI,CAAC;IAC9DyB,YAAY,GAAAvB,kBAAA,GAAEH,IAAI,CAAC0B,YAAY,cAAAvB,kBAAA,cAAAA,kBAAA,GAAI,EAAE;IACrCa,WAAW,GAAAZ,KAAA,IAAAC,iBAAA,GAAEL,IAAI,CAACgB,WAAW,cAAAX,iBAAA,cAAAA,iBAAA,GAAIL,IAAI,CAACiB,YAAY,cAAAb,KAAA,cAAAA,KAAA,GAAI,MAAM;IAC5DuB,UAAU,EAAE3B,IAAI,CAAC2B,UAAU;IAC3BC,YAAY,EAAE5B,IAAI,CAAC4B,YAAY;IACjCC,aAAa,GAAAvB,KAAA,IAAAC,mBAAA,GAAEP,IAAI,CAAC6B,aAAa,cAAAtB,mBAAA,cAAAA,mBAAA,GAAIP,IAAI,CAAC8B,YAAY,cAAAxB,KAAA,cAAAA,KAAA,GAAI,EAAE;IAC5DyB,cAAc,EAAElC,KAAK,CAACC,OAAO,CAACE,IAAI,CAAC+B,cAAc,CAAC,GAC9C/B,IAAI,CAAC+B,cAAc,CAChBhC,GAAG,CAAEiC,GAAG,IAAMA,GAAG,IAAI,IAAI,GAAG,EAAE,GAAGC,MAAM,CAACD,GAAG,CAAC,CAACE,IAAI,CAAC,CAAE,CAAC,CACrDC,MAAM,CAACC,OAAO,CAAC,GAClBpC,IAAI,CAAC6B,aAAa,GAClB,CAACI,MAAM,CAACjC,IAAI,CAAC6B,aAAa,CAAC,CAACK,IAAI,CAAC,CAAC,CAAC,GACnC,EAAE;IACJG,aAAa,EAAEhB,MAAM,EAAAb,KAAA,IAAAC,mBAAA,GAACT,IAAI,CAACqC,aAAa,cAAA5B,mBAAA,cAAAA,mBAAA,GAAIT,IAAI,CAACwB,SAAS,cAAAhB,KAAA,cAAAA,KAAA,GAAI,CAAC,CAAC,IAAI,CAAC;IACrEM,SAAS,EAAEJ,gBAAgB,CAAC;EAC9B,CAAC;AACH,CAAC,CAAC,GACF,EAAE;AAER,MAAM4B,eAAe,GAAIC,KAAK,IAAK;EACjC,IAAIA,KAAK,aAALA,KAAK,eAALA,KAAK,CAAEC,QAAQ,KAAKD,KAAK,CAACC,QAAQ,CAACC,MAAM,KAAK,GAAG,IAAIF,KAAK,CAACC,QAAQ,CAACC,MAAM,KAAK,GAAG,CAAC,EAAE;IACvF,OAAO;MAAE7C,KAAK,EAAE,EAAE;MAAE8C,YAAY,EAAE;IAAK,CAAC;EAC1C;EACAC,OAAO,CAACJ,KAAK,CAAC,iBAAiB,EAAEA,KAAK,CAAC;EACvC,OAAO;IAAE3C,KAAK,EAAE,EAAE;IAAE2C,KAAK,EAAE;EAAK,CAAC;AACnC,CAAC;AAED,OAAO,MAAMK,kBAAkB,GAAIhD,KAAK,IACtCC,KAAK,CAACC,OAAO,CAACF,KAAK,CAAC,GAChBA,KAAK,CAACiD,MAAM,CAAC,CAACC,GAAG,EAAE9C,IAAI,KAAK8C,GAAG,IAAIzB,MAAM,CAACrB,IAAI,CAACuB,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,GAClE,CAAC;AAEP,OAAO,MAAMwB,gBAAgB,GAAGA,CAACnD,KAAK,EAAE;EAAEoD,MAAM,GAAG;AAAM,CAAC,GAAG,CAAC,CAAC,KAAK;EAClE,MAAMC,KAAK,GAAGL,kBAAkB,CAAChD,KAAK,CAAC;EACvCsD,MAAM,CAACC,aAAa,CAClB,IAAIC,WAAW,CAAC,aAAa,EAAE;IAC7BC,MAAM,EAAE;MAAEJ,KAAK;MAAED;IAAO;EAC1B,CAAC,CACH,CAAC;AACH,CAAC;AAED,OAAO,MAAMM,cAAc,GAAG,MAAAA,CAAA,KAAY;EACxC,IAAI;IACF,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAM7D,KAAK,CAAC8D,GAAG,CAAC,WAAW,CAAC;IAC7C,OAAO;MAAE5D,KAAK,EAAED,kBAAkB,CAAC4D,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE3D,KAAK,CAAC;MAAE8C,YAAY,EAAE;IAAM,CAAC;EACxE,CAAC,CAAC,OAAOH,KAAK,EAAE;IACd,OAAOD,eAAe,CAACC,KAAK,CAAC;EAC/B;AACF,CAAC;AAED,OAAO,MAAMkB,cAAc,GAAG,MAAOC,OAAO,IAAK;EAC/C,IAAI;IACF,MAAM;MAAEH;IAAK,CAAC,GAAG,MAAM7D,KAAK,CAACiE,GAAG,CAAC,iBAAiB,EAAED,OAAO,CAAC;IAC5D,OAAO;MAAE9D,KAAK,EAAED,kBAAkB,CAAC4D,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE3D,KAAK,CAAC;MAAE8C,YAAY,EAAE;IAAM,CAAC;EACxE,CAAC,CAAC,OAAOH,KAAK,EAAE;IACd,OAAOD,eAAe,CAACC,KAAK,CAAC;EAC/B;AACF,CAAC;AAED,OAAO,MAAMqB,cAAc,GAAG,MAAOF,OAAO,IAAK;EAC/C,IAAI;IACF,MAAM;MAAEH;IAAK,CAAC,GAAG,MAAM7D,KAAK,CAACmE,MAAM,CAAC,iBAAiB,EAAE;MAAEN,IAAI,EAAEG;IAAQ,CAAC,CAAC;IACzE,OAAO;MAAE9D,KAAK,EAAED,kBAAkB,CAAC4D,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE3D,KAAK,CAAC;MAAE8C,YAAY,EAAE;IAAM,CAAC;EACxE,CAAC,CAAC,OAAOH,KAAK,EAAE;IACd,OAAOD,eAAe,CAACC,KAAK,CAAC;EAC/B;AACF,CAAC;AAED,OAAO,MAAMuB,SAAS,GAAG,MAAAA,CAAA,KAAY;EACnC,IAAI;IACF,MAAM;MAAEP;IAAK,CAAC,GAAG,MAAM7D,KAAK,CAACmE,MAAM,CAAC,WAAW,CAAC;IAChD,OAAO;MAAEjE,KAAK,EAAED,kBAAkB,CAAC4D,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE3D,KAAK,CAAC;MAAE8C,YAAY,EAAE;IAAM,CAAC;EACxE,CAAC,CAAC,OAAOH,KAAK,EAAE;IACd,OAAOD,eAAe,CAACC,KAAK,CAAC;EAC/B;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}