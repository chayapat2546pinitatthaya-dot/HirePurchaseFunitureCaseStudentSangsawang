{"ast":null,"code":"var _jsxFileName = \"D:\\\\xampp\\\\htdocs\\\\Website_Sangswang\\\\client\\\\src\\\\pages\\\\Cart.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport Container from 'react-bootstrap/Container';\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport Alert from 'react-bootstrap/Alert';\nimport axios from 'axios';\nimport { fetchCartItems, upsertCartItem, deleteCartItem, notifyCartUpdate } from '../utils/cartApi';\nimport './Cart.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst getItemKey = item => `${item.product_id}-${item.pricingType || 'cash'}`;\nconst createEmptyShipping = () => ({\n  recipientName: '',\n  recipientSurname: '',\n  phone: '',\n  address: ''\n});\nconst splitFullName = fullName => {\n  if (!fullName) {\n    return {\n      first: '',\n      last: ''\n    };\n  }\n  const parts = String(fullName).trim().split(/\\s+/).filter(Boolean);\n  if (parts.length === 0) {\n    return {\n      first: '',\n      last: ''\n    };\n  }\n  if (parts.length === 1) {\n    return {\n      first: parts[0],\n      last: ''\n    };\n  }\n  return {\n    first: parts[0],\n    last: parts.slice(1).join(' ')\n  };\n};\nconst toCleanString = value => value === undefined || value === null ? '' : String(value).trim();\nconst hasShippingValues = entry => {\n  if (!entry) {\n    return false;\n  }\n  return Object.values(entry).some(value => toCleanString(value).length > 0);\n};\nconst sanitizePhone = value => {\n  const cleaned = toCleanString(value).replace(/\\D+/g, '');\n  return cleaned;\n};\nconst normalizeShippingEntry = entry => {\n  const base = createEmptyShipping();\n  if (!entry) {\n    return base;\n  }\n  if (typeof entry === 'string') {\n    const trimmed = entry.trim();\n    if (!trimmed) {\n      return base;\n    }\n    if (trimmed.startsWith('{')) {\n      try {\n        return normalizeShippingEntry(JSON.parse(trimmed));\n      } catch (error) {\n        console.warn('Failed to parse shipping entry JSON:', trimmed, error);\n        return {\n          ...base,\n          address: trimmed\n        };\n      }\n    }\n    return {\n      ...base,\n      address: trimmed\n    };\n  }\n  return {\n    recipientName: toCleanString(entry.recipientName),\n    recipientSurname: toCleanString(entry.recipientSurname),\n    phone: sanitizePhone(entry.phone),\n    address: toCleanString(entry.address)\n  };\n};\nconst summarizeRecipient = entry => {\n  const normalized = normalizeShippingEntry(entry);\n  const name = [normalized.recipientName, normalized.recipientSurname].filter(Boolean).join(' ').trim();\n  if (name && normalized.phone) {\n    return `${name} · ${normalized.phone}`;\n  }\n  if (name) {\n    return name;\n  }\n  if (normalized.phone) {\n    return normalized.phone;\n  }\n  return '';\n};\nconst formatShippingPreview = entry => {\n  const normalized = normalizeShippingEntry(entry);\n  const lines = [];\n  const nameLine = [normalized.recipientName, normalized.recipientSurname].filter(Boolean).join(' ').trim();\n  if (nameLine) {\n    lines.push(nameLine);\n  }\n  if (normalized.phone) {\n    lines.push(`เบอร์โทรสำหรับติดต่อ: ${normalized.phone}`);\n  }\n  if (normalized.address) {\n    lines.push(normalized.address);\n  }\n  return lines.join('\\n');\n};\nconst INSTALLMENT_MIN_PERIODS = 2;\nconst INSTALLMENT_MAX_PERIODS = 12;\nconst DEFAULT_INSTALLMENT_PERIODS = 12;\nconst clampInstallmentPeriods = value => {\n  const numeric = Number(value);\n  if (!Number.isFinite(numeric)) {\n    return INSTALLMENT_MIN_PERIODS;\n  }\n  return Math.min(Math.max(numeric, INSTALLMENT_MIN_PERIODS), INSTALLMENT_MAX_PERIODS);\n};\nconst getInstallmentRateByMonths = (months = DEFAULT_INSTALLMENT_PERIODS) => {\n  const normalized = clampInstallmentPeriods(months);\n  // 2 เดือน: 10%, 3-12 เดือน: เพิ่มขึ้นเรื่อยๆ จนถึง 12 เดือนที่ 20%\n  if (normalized === INSTALLMENT_MIN_PERIODS) {\n    return 0.1; // 2 เดือน = 10%\n  }\n  if (normalized >= INSTALLMENT_MAX_PERIODS) {\n    return 0.2; // 12 เดือน = 20%\n  }\n  // 3-11 เดือน: คำนวณแบบ linear จาก 10% ถึง 20%\n  // rate = 0.1 + (months - 2) * (0.2 - 0.1) / (12 - 2)\n  return 0.1 + (normalized - INSTALLMENT_MIN_PERIODS) * (0.2 - 0.1) / (INSTALLMENT_MAX_PERIODS - INSTALLMENT_MIN_PERIODS);\n};\nconst calculateInstallmentTotalFromCash = (cashPrice, months = DEFAULT_INSTALLMENT_PERIODS) => {\n  const price = Number(cashPrice);\n  if (!Number.isFinite(price) || price <= 0) {\n    return 0;\n  }\n  const rate = getInstallmentRateByMonths(months);\n  return Math.round(price * (1 + rate));\n};\n\n/**\n * คำนวณจำนวนเงินผ่อนชำระแต่ละงวดให้ถูกต้องตามหลักบัญชี\n * เดือนแรกถึงเดือนก่อนสุดท้าย: ปัดขึ้นเป็นหลักสิบ\n * เดือนสุดท้าย: เก็บเศษที่เหลือ (เพื่อให้รวมเท่ากับ totalAmount พอดี)\n */\nconst calculateInstallmentAmounts = (totalAmount, periods) => {\n  const total = Number(totalAmount);\n  const numPeriods = Number(periods);\n  if (!Number.isFinite(total) || total <= 0 || !Number.isFinite(numPeriods) || numPeriods <= 0) {\n    return [];\n  }\n  if (numPeriods === 1) {\n    return [total];\n  }\n\n  // คำนวณจำนวนเงินต่อเดือนเฉลี่ย\n  const averagePerMonth = total / numPeriods;\n\n  // ปัดขึ้นเป็นหลักสิบ (ceil to nearest 10)\n  const regularAmount = Math.ceil(averagePerMonth / 10) * 10;\n\n  // เดือนแรกถึงเดือนก่อนสุดท้าย: ใช้ regularAmount\n  const amounts = [];\n  for (let i = 1; i < numPeriods; i++) {\n    amounts.push(regularAmount);\n  }\n\n  // เดือนสุดท้าย: เก็บเศษที่เหลือ (เพื่อให้รวมเท่ากับ totalAmount พอดี)\n  const regularTotal = regularAmount * (numPeriods - 1);\n  const lastAmount = total - regularTotal;\n  amounts.push(lastAmount);\n  return amounts;\n};\nconst parseNumeric = value => {\n  const number = Number(value);\n  return Number.isFinite(number) ? number : null;\n};\nconst resolveBestCashPrice = (productData, fallbackPrice = 0) => {\n  var _parseNumeric;\n  const fallback = (_parseNumeric = parseNumeric(fallbackPrice)) !== null && _parseNumeric !== void 0 ? _parseNumeric : 0;\n  if (!productData) {\n    return fallback;\n  }\n  const cashPromo = parseNumeric(productData.price_cash_promo);\n  const cash = parseNumeric(productData.price_cash);\n  if (cashPromo != null && cash != null && cashPromo < cash) {\n    return cashPromo;\n  }\n  if (cashPromo != null && cash == null) {\n    return cashPromo;\n  }\n  if (cash != null) {\n    return cash;\n  }\n  return fallback;\n};\nexport default function Cart() {\n  _s();\n  const navigate = useNavigate();\n  const [cart, setCart] = useState([]);\n  const [productsData, setProductsData] = useState({}); // เก็บข้อมูลสินค้าสำหรับหา price_cash\n  const [paymentMethod, setPaymentMethod] = useState('cash');\n  const [installmentPeriods, setInstallmentPeriods] = useState(6);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [submitAlert, setSubmitAlert] = useState({\n    show: false,\n    variant: 'info',\n    message: ''\n  });\n  const [orderResult, setOrderResult] = useState(null);\n  const [addressOptions, setAddressOptions] = useState([]);\n  const [selectedAddressKey, setSelectedAddressKey] = useState('');\n  const [useCustomAddress, setUseCustomAddress] = useState(true);\n  const [customShipping, setCustomShipping] = useState(createEmptyShipping);\n  const [defaultCustomShipping, setDefaultCustomShipping] = useState(createEmptyShipping);\n  const [selectedKeys, setSelectedKeys] = useState([]);\n  const [currentUser, setCurrentUser] = useState(() => {\n    const stored = localStorage.getItem('user');\n    if (!stored) {\n      return null;\n    }\n    try {\n      return JSON.parse(stored);\n    } catch (error) {\n      console.warn('Failed to parse stored user:', error);\n      return null;\n    }\n  });\n  const deriveCustomShippingSeed = (profileData, primaryEntry) => {\n    const normalizedPrimary = primaryEntry ? normalizeShippingEntry(primaryEntry) : createEmptyShipping();\n    const normalizedCustomerAddress = normalizeShippingEntry(profileData === null || profileData === void 0 ? void 0 : profileData.customer_address);\n    const profileFallback = {\n      recipientName: toCleanString(profileData === null || profileData === void 0 ? void 0 : profileData.customer_fname),\n      recipientSurname: toCleanString(profileData === null || profileData === void 0 ? void 0 : profileData.customer_lname),\n      phone: sanitizePhone(profileData === null || profileData === void 0 ? void 0 : profileData.customer_tel),\n      address: normalizedCustomerAddress.address\n    };\n    const {\n      first: userFirstName,\n      last: userLastName\n    } = splitFullName(currentUser === null || currentUser === void 0 ? void 0 : currentUser.name);\n    const currentUserFirstName = toCleanString(currentUser === null || currentUser === void 0 ? void 0 : currentUser.firstName) || userFirstName;\n    const currentUserLastName = toCleanString(currentUser === null || currentUser === void 0 ? void 0 : currentUser.lastName) || userLastName;\n    const currentUserPhone = sanitizePhone(currentUser === null || currentUser === void 0 ? void 0 : currentUser.phone);\n    const currentUserAddress = toCleanString(currentUser === null || currentUser === void 0 ? void 0 : currentUser.address);\n    return {\n      recipientName: normalizedPrimary.recipientName || profileFallback.recipientName || currentUserFirstName,\n      recipientSurname: normalizedPrimary.recipientSurname || profileFallback.recipientSurname || currentUserLastName,\n      phone: sanitizePhone(normalizedPrimary.phone || profileFallback.phone || currentUserPhone),\n      address: normalizedPrimary.address || profileFallback.address || currentUserAddress\n    };\n  };\n  const broadcastCartUpdate = (data, options = {}) => {\n    notifyCartUpdate(data, options);\n  };\n  const getImageUrl = imagePath => {\n    if (!imagePath || imagePath.trim() === '') {\n      return 'https://via.placeholder.com/400?text=ไม่มีรูปภาพ';\n    }\n    const trimmed = String(imagePath).trim();\n\n    // ถ้าเป็น URL แบบเต็ม (http:// หรือ https://) ให้ใช้ตามนั้น\n    if (trimmed.startsWith('http://') || trimmed.startsWith('https://')) {\n      return trimmed;\n    }\n\n    // ดึงรูปภาพจากโฟลเดอร์ images โดยตรงผ่าน static file serving (ไม่ผ่าน API)\n    // ใช้ relative path เพื่อให้ React proxy ทำงาน\n    // สำหรับ path ที่มีอักขระภาษาไทย ต้อง encode แต่ละส่วนของ path\n\n    // ถ้าเป็น path ที่เริ่มต้นด้วย / ให้ encode แต่ละส่วนของ path\n    if (trimmed.startsWith('/')) {\n      try {\n        // แยก path เป็นส่วนๆ และ encode แต่ละส่วน (ยกเว้น / หน้า)\n        const parts = trimmed.split('/').filter(p => p);\n        const encodedParts = parts.map(part => {\n          // Encode แต่ละส่วนของ path เพื่อให้ browser ส่งไปยัง server ถูกต้อง\n          try {\n            return encodeURIComponent(part);\n          } catch (e) {\n            return part;\n          }\n        });\n        return '/' + encodedParts.join('/');\n      } catch (e) {\n        return trimmed;\n      }\n    }\n\n    // ถ้าเป็น path ปกติ ให้แปลงเป็น absolute path\n    if (trimmed.includes('/') || trimmed.includes('\\\\')) {\n      // แปลง backslash เป็น forward slash\n      const normalized = trimmed.replace(/\\\\/g, '/');\n      // ถ้าไม่มี / หน้า ให้เพิ่ม\n      const pathToEncode = normalized.startsWith('/') ? normalized : `/${normalized}`;\n      try {\n        const parts = pathToEncode.split('/').filter(p => p);\n        const encodedParts = parts.map(part => {\n          try {\n            return encodeURIComponent(part);\n          } catch (e) {\n            return part;\n          }\n        });\n        return '/' + encodedParts.join('/');\n      } catch (e) {\n        return pathToEncode;\n      }\n    }\n\n    // ถ้าเป็นแค่ชื่อไฟล์ ให้ encode และใส่ใน /images/\n    try {\n      return `/images/${encodeURIComponent(trimmed)}`;\n    } catch (e) {\n      return `/images/${trimmed}`;\n    }\n  };\n  useEffect(() => {\n    loadCart();\n    loadAddressOptions();\n  }, []);\n  useEffect(() => {\n    const handleStorage = event => {\n      if (event.key === 'token') {\n        loadAddressOptions();\n        loadCart({\n          silent: true\n        });\n      }\n      if (event.key === 'user') {\n        const storedUser = event.newValue;\n        if (storedUser) {\n          try {\n            setCurrentUser(JSON.parse(storedUser));\n          } catch (error) {\n            console.warn('Failed to parse user from storage event:', error);\n            setCurrentUser(null);\n          }\n        } else {\n          setCurrentUser(null);\n        }\n        loadAddressOptions();\n        loadCart({\n          silent: true\n        });\n      }\n    };\n    window.addEventListener('storage', handleStorage);\n    return () => window.removeEventListener('storage', handleStorage);\n  }, []);\n  useEffect(() => {\n    const syncUser = event => {\n      var _event$detail;\n      if ((event === null || event === void 0 ? void 0 : (_event$detail = event.detail) === null || _event$detail === void 0 ? void 0 : _event$detail.user) !== undefined) {\n        setCurrentUser(event.detail.user);\n      } else {\n        const stored = localStorage.getItem('user');\n        if (stored) {\n          try {\n            setCurrentUser(JSON.parse(stored));\n          } catch (error) {\n            console.warn('Failed to parse stored user on sync:', error);\n            setCurrentUser(null);\n          }\n        } else {\n          setCurrentUser(null);\n        }\n      }\n      loadAddressOptions();\n    };\n    window.addEventListener('userChanged', syncUser);\n    return () => window.removeEventListener('userChanged', syncUser);\n  }, []);\n  useEffect(() => {\n    setSelectedKeys(prev => {\n      if (prev.length === 0) {\n        return prev;\n      }\n      const availableKeys = cart.map(item => getItemKey(item));\n      return prev.filter(key => availableKeys.includes(key));\n    });\n  }, [cart]);\n\n  // ฟังก์ชันสำหรับแสดง pricing label\n  // ถ้าเป็นโปรโมชัน ให้แสดง \"โปรโมชัน\"\n  // ถ้าไม่มีโปรโมชัน ไม่ต้องแสดงอะไร\n  const getPricingLabel = pricingType => {\n    if (!pricingType) return '';\n    const type = String(pricingType).toLowerCase();\n    if (type.includes('promo')) {\n      return 'โปรโมชัน';\n    }\n    return '';\n  };\n  const syncCartState = (items, {\n    preserveSelection = true,\n    silent = false\n  } = {}) => {\n    const normalized = Array.isArray(items) ? items.map(item => {\n      var _ref, _item$unitPrice;\n      return {\n        ...item,\n        unitPrice: (_ref = (_item$unitPrice = item.unitPrice) !== null && _item$unitPrice !== void 0 ? _item$unitPrice : item.product_price) !== null && _ref !== void 0 ? _ref : 0,\n        pricingType: item.pricingType || 'cash',\n        pricingLabel: getPricingLabel(item.pricingType || 'cash')\n      };\n    }) : [];\n    setCart(normalized);\n    setSelectedKeys(prev => {\n      const availableKeys = normalized.map(item => getItemKey(item));\n      if (!preserveSelection || prev.length === 0) {\n        return availableKeys;\n      }\n      const filtered = prev.filter(key => availableKeys.includes(key));\n      return filtered.length > 0 ? filtered : availableKeys;\n    });\n    broadcastCartUpdate(normalized, {\n      silent\n    });\n\n    // ดึงข้อมูลสินค้าเพื่อหา price_cash เมื่อมีการเปลี่ยนแปลงตะกร้า\n    const productIds = normalized.map(item => item.product_id);\n    if (productIds.length > 0) {\n      loadProductsData(productIds);\n    }\n  };\n\n  // ฟังก์ชันสำหรับดึงข้อมูลสินค้าเพื่อหา price_cash\n  const loadProductsData = async productIds => {\n    if (!productIds || productIds.length === 0) return;\n    try {\n      const uniqueIds = [...new Set(productIds)];\n      const productsMap = {};\n\n      // ดึงข้อมูลสินค้าแต่ละตัว\n      await Promise.all(uniqueIds.map(async productId => {\n        try {\n          const response = await axios.get(`/api/products/${productId}`);\n          if (response.data) {\n            productsMap[productId] = {\n              price_cash: response.data.price_cash,\n              price_cash_promo: response.data.price_cash_promo,\n              price_installment: response.data.price_installment,\n              price_installment_promo: response.data.price_installment_promo\n            };\n          }\n        } catch (error) {\n          console.error(`Failed to fetch product ${productId}:`, error);\n        }\n      }));\n      setProductsData(prev => ({\n        ...prev,\n        ...productsMap\n      }));\n    } catch (error) {\n      console.error('Failed to load products data:', error);\n    }\n  };\n\n  // ฟังก์ชันสำหรับหาราคาเงินสด (โปรโมชันก่อน ถ้าไม่มีใช้ราคาปกติ)\n  const getCashPrice = item => {\n    const productId = item.product_id;\n    const productData = productsData[productId];\n    return resolveBestCashPrice(productData, item.unitPrice);\n  };\n\n  // ฟังก์ชันสำหรับหาราคาแบบผ่อน (โปรโมชันก่อน ถ้าไม่มีใช้ราคาปกติ)\n  const getInstallmentPrice = item => {\n    const productId = item.product_id;\n    const productData = productsData[productId];\n    const baseCashPrice = resolveBestCashPrice(productData, item.unitPrice);\n    const periods = clampInstallmentPeriods(installmentPeriods);\n    return calculateInstallmentTotalFromCash(baseCashPrice, periods);\n  };\n  const loadCart = async ({\n    silent = true\n  } = {}) => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      syncCartState([], {\n        preserveSelection: false,\n        silent\n      });\n      return;\n    }\n    const result = await fetchCartItems();\n    if (result.unauthorized || result.error) {\n      syncCartState([], {\n        preserveSelection: false,\n        silent: true\n      });\n      if (result.error) {\n        console.error('Failed to load cart items from server');\n      }\n      return;\n    }\n    syncCartState(result.items, {\n      preserveSelection: false,\n      silent\n    });\n\n    // ดึงข้อมูลสินค้าเพื่อหา price_cash\n    const productIds = result.items.map(item => item.product_id);\n    if (productIds.length > 0) {\n      loadProductsData(productIds);\n    }\n  };\n  const loadAddressOptions = async () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setAddressOptions([]);\n      setSelectedAddressKey('custom');\n      setUseCustomAddress(true);\n      const fallbackSeed = deriveCustomShippingSeed();\n      setDefaultCustomShipping(fallbackSeed);\n      setCustomShipping(prev => hasShippingValues(prev) ? prev : fallbackSeed);\n      return;\n    }\n    try {\n      const response = await axios.get('/api/customer/profile');\n      const shippingProfile = response.data.shipping_profile || {};\n      const alternatives = Array.isArray(shippingProfile.alternatives) ? shippingProfile.alternatives : Array.isArray(response.data.alternativeAddresses) ? response.data.alternativeAddresses : [];\n      const primaryEntry = normalizeShippingEntry(shippingProfile.primary || response.data.customer_address);\n      const defaultSeed = deriveCustomShippingSeed(response.data, shippingProfile.primary || response.data.customer_address);\n      const options = [];\n      if (primaryEntry.address) {\n        options.push({\n          key: 'primary',\n          label: summarizeRecipient(primaryEntry) ? `รายละเอียดที่อยู่ · ${summarizeRecipient(primaryEntry)}` : 'รายละเอียดที่อยู่',\n          value: primaryEntry\n        });\n      }\n      alternatives.forEach((address, index) => {\n        const entry = normalizeShippingEntry(address);\n        if (!entry.address) {\n          return;\n        }\n        options.push({\n          key: `alt-${index}`,\n          label: summarizeRecipient(entry) ? `ที่อยู่สำรอง ${index + 1} · ${summarizeRecipient(entry)}` : `ที่อยู่สำรอง ${index + 1}`,\n          value: entry\n        });\n      });\n      setAddressOptions(options);\n      setDefaultCustomShipping(defaultSeed);\n      setCustomShipping(prev => hasShippingValues(prev) ? prev : defaultSeed);\n      if (options.length > 0) {\n        setSelectedAddressKey(options[0].key);\n        setUseCustomAddress(false);\n      } else {\n        setSelectedAddressKey('custom');\n        setUseCustomAddress(true);\n      }\n    } catch (error) {\n      console.error('Error loading profile addresses:', error);\n      setAddressOptions([]);\n      setSelectedAddressKey('custom');\n      setUseCustomAddress(true);\n      const fallbackSeed = deriveCustomShippingSeed();\n      setDefaultCustomShipping(fallbackSeed);\n      setCustomShipping(prev => hasShippingValues(prev) ? prev : fallbackSeed);\n    }\n  };\n  const getSelectedAddressValue = () => {\n    if (useCustomAddress || selectedAddressKey === 'custom') {\n      return normalizeShippingEntry(customShipping);\n    }\n    const option = addressOptions.find(item => item.key === selectedAddressKey);\n    return option ? normalizeShippingEntry(option.value) : createEmptyShipping();\n  };\n  const updateQuantity = async (productId, pricingType, newQuantity) => {\n    if (newQuantity <= 0) {\n      await removeFromCart(productId, pricingType);\n      return;\n    }\n    const target = cart.find(item => item.product_id === productId && item.pricingType === pricingType);\n    if (!target) {\n      return;\n    }\n    const result = await upsertCartItem({\n      productId,\n      pricingType,\n      quantity: newQuantity,\n      unitPrice: target.unitPrice,\n      pricingLabel: target.pricingLabel,\n      mode: 'set'\n    });\n    if (result.unauthorized) {\n      navigate('/login');\n      return;\n    }\n    if (result.error) {\n      setSubmitAlert({\n        show: true,\n        variant: 'danger',\n        message: 'ไม่สามารถอัปเดตจำนวนสินค้าได้ กรุณาลองใหม่อีกครั้ง'\n      });\n      return;\n    }\n    syncCartState(result.items, {\n      preserveSelection: true\n    });\n  };\n  const removeFromCart = async (productId, pricingType) => {\n    const result = await deleteCartItem({\n      productId,\n      pricingType\n    });\n    if (result.unauthorized) {\n      navigate('/login');\n      return;\n    }\n    if (result.error) {\n      setSubmitAlert({\n        show: true,\n        variant: 'danger',\n        message: 'ไม่สามารถลบสินค้าออกจากตะกร้าได้ กรุณาลองใหม่อีกครั้ง'\n      });\n      return;\n    }\n    syncCartState(result.items, {\n      preserveSelection: true\n    });\n  };\n  const formatPriceValue = value => {\n    if (value == null) {\n      return '0';\n    }\n    const number = Number(value);\n    if (!Number.isFinite(number)) {\n      return '0';\n    }\n    return number.toLocaleString();\n  };\n  const shouldShowBasePrice = item => {\n    if (!item) {\n      return false;\n    }\n    const pricingType = String(item.pricingType || '').toLowerCase();\n    if (!pricingType.includes('promo')) {\n      return false;\n    }\n    const base = Number(item.basePrice);\n    const promo = Number(item.unitPrice);\n    return Number.isFinite(base) && Number.isFinite(promo) && base > promo;\n  };\n  const selectedItems = useMemo(() => cart.filter(item => selectedKeys.includes(getItemKey(item))), [cart, selectedKeys]);\n\n  // คำนวณยอดรวมโดยใช้ราคาตามวิธีการชำระเงิน\n  const total = useMemo(() => selectedItems.reduce((sum, item) => {\n    const price = paymentMethod === 'installment' ? getInstallmentPrice(item) : getCashPrice(item);\n    return sum + price * item.quantity;\n  }, 0), [selectedItems, productsData, paymentMethod, installmentPeriods]);\n\n  // ค่าจัดส่ง\n  const shippingFee = 0;\n\n  // คำนวณ VAT 7% - ราคาสินค้าที่ได้จากตะกร้าเป็นราคารวม VAT แล้ว\n  // ดังนั้นต้องแยกเป็นราคาก่อน VAT และ VAT\n  const vatRate = 0.07;\n  const subtotalExcludeVat = total / (1 + vatRate); // ราคารวมสินค้าก่อน VAT\n  const vatAmount = subtotalExcludeVat * vatRate; // จำนวน VAT 7%\n  const netTotal = subtotalExcludeVat + vatAmount + shippingFee; // ยอดรวมสุทธิ (ควรเท่ากับ total + shippingFee)\n\n  const allSelected = cart.length > 0 && selectedKeys.length === cart.length;\n  const selectedCount = selectedItems.length;\n  const isSubmitDisabled = selectedCount === 0 || isSubmitting;\n  const normalizedInstallmentPeriods = useMemo(() => clampInstallmentPeriods(installmentPeriods), [installmentPeriods]);\n  const toggleItemSelection = item => {\n    const key = getItemKey(item);\n    setSelectedKeys(prev => prev.includes(key) ? prev.filter(value => value !== key) : [...prev, key]);\n  };\n  const toggleSelectAll = () => {\n    if (allSelected) {\n      setSelectedKeys([]);\n    } else {\n      setSelectedKeys(cart.map(item => getItemKey(item)));\n    }\n  };\n\n  // คำนวณจำนวนเงินแต่ละงวดให้ถูกต้องตามหลักบัญชี\n  const installmentAmounts = useMemo(() => {\n    if (normalizedInstallmentPeriods <= 0) {\n      return [];\n    }\n    return calculateInstallmentAmounts(netTotal, normalizedInstallmentPeriods);\n  }, [netTotal, normalizedInstallmentPeriods]);\n\n  // ใช้จำนวนเงินงวดแรกเป็นราคาต่อเดือนสำหรับแสดงผล\n  const roundedInstallmentAmount = useMemo(() => {\n    if (!installmentAmounts || installmentAmounts.length === 0) {\n      return 0;\n    }\n    return installmentAmounts[0];\n  }, [installmentAmounts]);\n  const highlightLabel = paymentMethod === 'installment' ? `ค่างวดผ่อนโดยประมาณ (${normalizedInstallmentPeriods} งวด)` : 'ยอดที่ต้องชำระ';\n  const highlightAmount = paymentMethod === 'installment' ? roundedInstallmentAmount : netTotal;\n  const handleSubmitOrder = async () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setSubmitAlert({\n        show: true,\n        variant: 'warning',\n        message: 'กรุณาเข้าสู่ระบบก่อนส่งคำสั่งซื้อ'\n      });\n      setTimeout(() => navigate('/login'), 1200);\n      return;\n    }\n    if (selectedItems.length === 0) {\n      setSubmitAlert({\n        show: true,\n        variant: 'warning',\n        message: 'กรุณาเลือกสินค้าอย่างน้อย 1 รายการก่อนส่งคำสั่งซื้อ'\n      });\n      return;\n    }\n    const shippingAddress = normalizeShippingEntry(getSelectedAddressValue());\n    if (!shippingAddress.address) {\n      setSubmitAlert({\n        show: true,\n        variant: 'danger',\n        message: 'กรุณาเลือกหรือกรอกที่อยู่จัดส่งก่อนดำเนินการ'\n      });\n      return;\n    }\n    setIsSubmitting(true);\n    setSubmitAlert({\n      show: false,\n      variant: 'info',\n      message: ''\n    });\n    try {\n      var _response$data, _response$data2;\n      const periods = paymentMethod === 'installment' ? normalizedInstallmentPeriods : 1;\n      const items = selectedItems.map(item => {\n        const itemPrice = paymentMethod === 'installment' ? getInstallmentPrice(item) : getCashPrice(item);\n        return {\n          product_id: item.product_id,\n          quantity: item.quantity,\n          price: itemPrice,\n          // ใช้ราคาตามวิธีการชำระเงิน\n          pricingType: paymentMethod === 'installment' ? 'installment' : 'cash'\n        };\n      });\n      const response = await axios.post('/api/orders', {\n        items,\n        paymentMethod,\n        installmentPeriods: periods,\n        shippingAddress\n      });\n      const createdOrderId = (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.order_id;\n      setOrderResult({\n        orderId: createdOrderId,\n        total: netTotal,\n        paymentMethod,\n        periods,\n        shippingAddress: ((_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : _response$data2.shipping_address) || shippingAddress\n      });\n      let latestItems = cart;\n      for (const item of selectedItems) {\n        const result = await deleteCartItem({\n          productId: item.product_id,\n          pricingType: item.pricingType || 'cash'\n        });\n        if (result.unauthorized) {\n          latestItems = [];\n          break;\n        }\n        if (!result.error) {\n          latestItems = result.items;\n        }\n      }\n      syncCartState(latestItems, {\n        preserveSelection: false\n      });\n      setCustomShipping(createEmptyShipping());\n      setSubmitAlert({\n        show: true,\n        variant: 'success',\n        message: 'ส่งคำสั่งซื้อเรียบร้อยแล้ว ระบบกำลังรอแอดมินอนุมัติ'\n      });\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('Submit order error:', error);\n      setSubmitAlert({\n        show: true,\n        variant: 'danger',\n        message: ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.error) || 'ส่งคำสั่งซื้อไม่สำเร็จ โปรดลองอีกครั้ง'\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n  if (cart.length === 0) {\n    if (orderResult) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-page empty\",\n        children: /*#__PURE__*/_jsxDEV(Container, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"empty-cart success\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"empty-icon success\",\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"bi bi-hourglass-split\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 845,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 844,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u0E16\\u0E39\\u0E01\\u0E2A\\u0E48\\u0E07\\u0E40\\u0E23\\u0E35\\u0E22\\u0E1A\\u0E23\\u0E49\\u0E2D\\u0E22\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 847,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u0E40\\u0E25\\u0E02\\u0E17\\u0E35\\u0E48 #\", orderResult.orderId || '-', \" \\u0E2D\\u0E22\\u0E39\\u0E48\\u0E43\\u0E19\\u0E2A\\u0E16\\u0E32\\u0E19\\u0E30 \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"\\u0E23\\u0E2D\\u0E2D\\u0E19\\u0E38\\u0E21\\u0E31\\u0E15\\u0E34\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 849,\n                columnNumber: 76\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 850,\n                columnNumber: 17\n              }, this), orderResult.shippingAddress && /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E08\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E07:\", /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 855,\n                    columnNumber: 23\n                  }, this), formatShippingPreview(normalizeShippingEntry(orderResult.shippingAddress))]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 854,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 858,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 852,\n                columnNumber: 20\n              }, this), \"\\u0E04\\u0E38\\u0E13\\u0E2A\\u0E32\\u0E21\\u0E32\\u0E23\\u0E16\\u0E15\\u0E34\\u0E14\\u0E15\\u0E32\\u0E21\\u0E04\\u0E27\\u0E32\\u0E21\\u0E04\\u0E37\\u0E1A\\u0E2B\\u0E19\\u0E49\\u0E32\\u0E44\\u0E14\\u0E49\\u0E17\\u0E35\\u0E48\\u0E40\\u0E21\\u0E19\\u0E39 \\\"\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\\" \\u0E41\\u0E25\\u0E30\\u0E17\\u0E35\\u0E21\\u0E07\\u0E32\\u0E19\\u0E08\\u0E30\\u0E15\\u0E34\\u0E14\\u0E15\\u0E48\\u0E2D\\u0E01\\u0E25\\u0E31\\u0E1A\\u0E17\\u0E31\\u0E19\\u0E17\\u0E35\\u0E40\\u0E21\\u0E37\\u0E48\\u0E2D\\u0E14\\u0E33\\u0E40\\u0E19\\u0E34\\u0E19\\u0E01\\u0E32\\u0E23\\u0E40\\u0E2A\\u0E23\\u0E47\\u0E08\\u0E2A\\u0E34\\u0E49\\u0E19\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 848,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"success-actions\",\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                className: \"btn-primary-custom\",\n                onClick: () => navigate('/orders'),\n                children: \"\\u0E14\\u0E39\\u0E2A\\u0E16\\u0E32\\u0E19\\u0E30\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u0E02\\u0E2D\\u0E07\\u0E09\\u0E31\\u0E19\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 864,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                className: \"btn-outline\",\n                onClick: () => navigate('/'),\n                children: \"\\u0E01\\u0E25\\u0E31\\u0E1A\\u0E44\\u0E1B\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E40\\u0E15\\u0E34\\u0E21\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 867,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 863,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 843,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 842,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 841,\n        columnNumber: 9\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cart-page empty\",\n      children: /*#__PURE__*/_jsxDEV(Container, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"empty-cart\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"empty-icon\",\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"bi bi-bag\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 882,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 881,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"\\u0E22\\u0E31\\u0E07\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\\u0E43\\u0E19\\u0E15\\u0E30\\u0E01\\u0E23\\u0E49\\u0E32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 884,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"\\u0E40\\u0E23\\u0E34\\u0E48\\u0E21\\u0E15\\u0E49\\u0E19\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\\u0E17\\u0E35\\u0E48\\u0E04\\u0E38\\u0E13\\u0E0A\\u0E2D\\u0E1A \\u0E41\\u0E25\\u0E49\\u0E27\\u0E01\\u0E25\\u0E31\\u0E1A\\u0E21\\u0E32\\u0E17\\u0E35\\u0E48\\u0E19\\u0E35\\u0E48\\u0E2D\\u0E35\\u0E01\\u0E04\\u0E23\\u0E31\\u0E49\\u0E07\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 885,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            className: \"btn-primary-custom\",\n            onClick: () => navigate('/'),\n            children: \"\\u0E44\\u0E1B\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 886,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 880,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 879,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 878,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"cart-page\",\n    children: /*#__PURE__*/_jsxDEV(Container, {\n      fluid: true,\n      className: \"cart-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        className: \"cart-page__hero\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cart-page__hero-text\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"cart-tagline\",\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"bi bi-cart-check\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 901,\n              columnNumber: 15\n            }, this), \"\\u0E15\\u0E30\\u0E01\\u0E23\\u0E49\\u0E32\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 900,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\\u0E41\\u0E25\\u0E30\\u0E2A\\u0E23\\u0E38\\u0E1B\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u0E02\\u0E2D\\u0E07\\u0E04\\u0E38\\u0E13\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 904,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E40\\u0E09\\u0E1E\\u0E32\\u0E30\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\\u0E17\\u0E35\\u0E48\\u0E15\\u0E49\\u0E2D\\u0E07\\u0E01\\u0E32\\u0E23\\u0E0A\\u0E33\\u0E23\\u0E30\\u0E43\\u0E19\\u0E23\\u0E2D\\u0E1A\\u0E19\\u0E35\\u0E49 \\u0E41\\u0E25\\u0E49\\u0E27\\u0E23\\u0E30\\u0E1A\\u0E38\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E08\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E07\\u0E43\\u0E2B\\u0E49\\u0E40\\u0E23\\u0E35\\u0E22\\u0E1A\\u0E23\\u0E49\\u0E2D\\u0E22\", /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                whiteSpace: 'nowrap'\n              },\n              children: \"\\u0E17\\u0E35\\u0E21\\u0E07\\u0E32\\u0E19\\u0E08\\u0E30\\u0E15\\u0E34\\u0E14\\u0E15\\u0E48\\u0E2D\\u0E01\\u0E25\\u0E31\\u0E1A\\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E2A\\u0E23\\u0E38\\u0E1B\\u0E23\\u0E32\\u0E22\\u0E25\\u0E30\\u0E40\\u0E2D\\u0E35\\u0E22\\u0E14\\u0E2D\\u0E22\\u0E48\\u0E32\\u0E07\\u0E23\\u0E27\\u0E14\\u0E40\\u0E23\\u0E47\\u0E27\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 907,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 905,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 899,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          className: \"btn-ghost\",\n          onClick: () => navigate('/'),\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"bi bi-plus-circle me-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 911,\n            columnNumber: 13\n          }, this), \"\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 910,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 898,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"cart-card cart-card--items\",\n        children: [/*#__PURE__*/_jsxDEV(\"header\", {\n          className: \"cart-card__header\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: [\"\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 (\", cart.length, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 919,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E17\\u0E35\\u0E48\\u0E15\\u0E49\\u0E2D\\u0E07\\u0E01\\u0E32\\u0E23\\u0E0A\\u0E33\\u0E23\\u0E30 \\u0E41\\u0E01\\u0E49\\u0E44\\u0E02\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19 \\u0E2B\\u0E23\\u0E37\\u0E2D\\u0E19\\u0E33\\u0E2D\\u0E2D\\u0E01\\u0E44\\u0E14\\u0E49\\u0E17\\u0E31\\u0E19\\u0E17\\u0E35\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 920,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 918,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"cart-select-all\",\n            onClick: toggleSelectAll,\n            children: [/*#__PURE__*/_jsxDEV(Form.Check, {\n              type: \"checkbox\",\n              checked: allSelected,\n              readOnly: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 923,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: allSelected ? 'ยกเลิกทั้งหมด' : 'เลือกทั้งหมด'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 924,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 922,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 917,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cart-items\",\n          children: cart.map(item => {\n            const itemKey = getItemKey(item);\n            const isSelected = selectedKeys.includes(itemKey);\n            const itemPrice = paymentMethod === 'installment' ? getInstallmentPrice(item) : getCashPrice(item);\n            const productData = productsData[item.product_id];\n\n            // ตรวจสอบว่ามีโปรโมชันหรือไม่\n            let hasPromo = false;\n            let basePrice = null;\n            if (paymentMethod === 'installment') {\n              hasPromo = productData && productData.price_installment_promo != null && productData.price_installment != null && parseFloat(productData.price_installment_promo) < parseFloat(productData.price_installment);\n              basePrice = hasPromo ? parseFloat(productData.price_installment) : null;\n            } else {\n              hasPromo = productData && productData.price_cash_promo != null && productData.price_cash != null && parseFloat(productData.price_cash_promo) < parseFloat(productData.price_cash);\n              basePrice = hasPromo ? parseFloat(productData.price_cash) : null;\n            }\n            const showBasePrice = hasPromo;\n            const pricingLabel = hasPromo ? 'โปรโมชัน' : '';\n            const promoLabelClass = showBasePrice ? ' cart-item__label--promo' : '';\n            return /*#__PURE__*/_jsxDEV(\"article\", {\n              className: `cart-item${isSelected ? ' cart-item--selected' : ''}`,\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-item__select\",\n                children: /*#__PURE__*/_jsxDEV(Form.Check, {\n                  type: \"checkbox\",\n                  checked: isSelected,\n                  onChange: () => toggleItemSelection(item),\n                  \"aria-label\": `เลือก ${item.product_name}`\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 962,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 961,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n                src: getImageUrl(item.product_image),\n                alt: item.product_name,\n                className: \"cart-item__image\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 969,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-item__info\",\n                children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                  children: item.product_name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 975,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"cart-item__sku\",\n                  children: [\"\\u0E23\\u0E2B\\u0E31\\u0E2A\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32 #\", item.product_id]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 976,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"cart-item__meta\",\n                  children: [showBasePrice && basePrice != null && /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"cart-item__price cart-item__price--original\",\n                    children: [\"\\u0E3F\", formatPriceValue(basePrice)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 979,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"cart-item__price\",\n                    children: [\"\\u0E3F\", formatPriceValue(itemPrice)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 983,\n                    columnNumber: 23\n                  }, this), pricingLabel && /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: `cart-item__label${promoLabelClass}`,\n                    children: pricingLabel\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 987,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 977,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 974,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-item__controls\",\n                children: /*#__PURE__*/_jsxDEV(Form.Control, {\n                  type: \"number\",\n                  min: \"1\",\n                  value: item.quantity,\n                  onChange: e => updateQuantity(item.product_id, item.pricingType, parseInt(e.target.value, 10))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 994,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 993,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-item__total\",\n                children: [\"\\u0E3F\", (itemPrice * item.quantity).toLocaleString()]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1007,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"cart-item__remove\",\n                onClick: () => removeFromCart(item.product_id, item.pricingType),\n                \"aria-label\": `ลบ ${item.product_name}`,\n                children: /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"bi bi-x-lg\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1016,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1010,\n                columnNumber: 19\n              }, this)]\n            }, itemKey, true, {\n              fileName: _jsxFileName,\n              lineNumber: 960,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 928,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 916,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"cart-grid\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cart-card\",\n          children: [/*#__PURE__*/_jsxDEV(\"header\", {\n            className: \"cart-card__header\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                children: \"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E08\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E07\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1028,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E08\\u0E32\\u0E01\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E17\\u0E35\\u0E48\\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01\\u0E44\\u0E27\\u0E49 \\u0E2B\\u0E23\\u0E37\\u0E2D\\u0E23\\u0E30\\u0E1A\\u0E38\\u0E43\\u0E2B\\u0E21\\u0E48\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E04\\u0E33\\u0E2A\\u0E31\\u0E48\\u0E07\\u0E0B\\u0E37\\u0E49\\u0E2D\\u0E19\\u0E35\\u0E49\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1029,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1027,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1026,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cart-card__body\",\n            children: [addressOptions.length > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(Form.Select, {\n                className: \"shipping-select\",\n                value: useCustomAddress ? 'custom' : selectedAddressKey,\n                onChange: event => {\n                  const value = event.target.value;\n                  if (value === 'custom') {\n                    setUseCustomAddress(true);\n                    setSelectedAddressKey('custom');\n                    setCustomShipping(prev => hasShippingValues(prev) ? prev : defaultCustomShipping);\n                  } else {\n                    setUseCustomAddress(false);\n                    setSelectedAddressKey(value);\n                  }\n                },\n                children: [addressOptions.map(option => /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: option.key,\n                  children: option.label\n                }, option.key, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1053,\n                  columnNumber: 24\n                }, this)), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: \"custom\",\n                  children: \"\\u0E23\\u0E30\\u0E1A\\u0E38\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E43\\u0E2B\\u0E21\\u0E48\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E2D\\u0E2D\\u0E40\\u0E14\\u0E2D\\u0E23\\u0E4C\\u0E19\\u0E35\\u0E49\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1057,\n                  columnNumber: 22\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1035,\n                columnNumber: 20\n              }, this), !useCustomAddress && selectedAddressKey !== 'custom' && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"shipping-preview\",\n                children: formatShippingPreview(getSelectedAddressValue())\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1060,\n                columnNumber: 22\n              }, this)]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"shipping-note\",\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"bi bi-geo\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1067,\n                columnNumber: 20\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u0E22\\u0E31\\u0E07\\u0E44\\u0E21\\u0E48\\u0E21\\u0E35\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E43\\u0E19\\u0E1A\\u0E31\\u0E0D\\u0E0A\\u0E35 \\u0E01\\u0E23\\u0E38\\u0E13\\u0E32\\u0E01\\u0E23\\u0E2D\\u0E01\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E08\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E07\\u0E14\\u0E49\\u0E32\\u0E19\\u0E25\\u0E48\\u0E32\\u0E07\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1068,\n                columnNumber: 20\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1066,\n              columnNumber: 18\n            }, this), (useCustomAddress || addressOptions.length === 0) && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"shipping-custom-grid\",\n                children: [/*#__PURE__*/_jsxDEV(Form.Group, {\n                  children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                    children: \"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E1C\\u0E39\\u0E49\\u0E23\\u0E31\\u0E1A\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1076,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                    type: \"text\",\n                    value: customShipping.recipientName,\n                    onChange: event => setCustomShipping(prev => ({\n                      ...prev,\n                      recipientName: event.target.value\n                    })),\n                    placeholder: \"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E08\\u0E23\\u0E34\\u0E07\\u0E02\\u0E2D\\u0E07\\u0E1C\\u0E39\\u0E49\\u0E23\\u0E31\\u0E1A\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1077,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1075,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n                  children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                    children: \"\\u0E19\\u0E32\\u0E21\\u0E2A\\u0E01\\u0E38\\u0E25\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1087,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                    type: \"text\",\n                    value: customShipping.recipientSurname,\n                    onChange: event => setCustomShipping(prev => ({\n                      ...prev,\n                      recipientSurname: event.target.value\n                    })),\n                    placeholder: \"\\u0E19\\u0E32\\u0E21\\u0E2A\\u0E01\\u0E38\\u0E25\\u0E1C\\u0E39\\u0E49\\u0E23\\u0E31\\u0E1A\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1088,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1086,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n                  children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                    children: \"\\u0E40\\u0E1A\\u0E2D\\u0E23\\u0E4C\\u0E42\\u0E17\\u0E23\\u0E2A\\u0E33\\u0E2B\\u0E23\\u0E31\\u0E1A\\u0E15\\u0E34\\u0E14\\u0E15\\u0E48\\u0E2D\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1098,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                    type: \"tel\",\n                    value: customShipping.phone,\n                    onChange: event => setCustomShipping(prev => ({\n                      ...prev,\n                      phone: sanitizePhone(event.target.value)\n                    })),\n                    placeholder: \"\\u0E40\\u0E1A\\u0E2D\\u0E23\\u0E4C\\u0E42\\u0E17\\u0E23\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1099,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1097,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1074,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                as: \"textarea\",\n                rows: 3,\n                value: customShipping.address,\n                onChange: event => setCustomShipping(prev => ({\n                  ...prev,\n                  address: event.target.value\n                })),\n                placeholder: \"\\u0E40\\u0E0A\\u0E48\\u0E19 90/12 \\u0E2B\\u0E21\\u0E39\\u0E48\\u0E1A\\u0E49\\u0E32\\u0E19\\u0E41\\u0E2A\\u0E07\\u0E2A\\u0E27\\u0E48\\u0E32\\u0E07 \\u0E0B\\u0E2D\\u0E22\\u0E2A\\u0E38\\u0E02\\u0E2A\\u0E31\\u0E19\\u0E15\\u0E4C \\u0E41\\u0E02\\u0E27\\u0E07\\u0E15\\u0E25\\u0E32\\u0E14 \\u0E19\\u0E19\\u0E17\\u0E1A\\u0E38\\u0E23\\u0E35 11000\",\n                className: \"shipping-textarea\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1112,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true), /*#__PURE__*/_jsxDEV(Button, {\n              type: \"button\",\n              variant: \"link\",\n              className: \"manage-address-link\",\n              onClick: () => navigate('/profile?tab=addresses'),\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"bi bi-pencil-square me-1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1130,\n                columnNumber: 17\n              }, this), \"\\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E08\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E07\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1124,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1032,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1025,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cart-card\",\n          children: [/*#__PURE__*/_jsxDEV(\"header\", {\n            className: \"cart-card__header\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                children: \"\\u0E27\\u0E34\\u0E18\\u0E35\\u0E01\\u0E32\\u0E23\\u0E0A\\u0E33\\u0E23\\u0E30\\u0E40\\u0E07\\u0E34\\u0E19\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1139,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E23\\u0E39\\u0E1B\\u0E41\\u0E1A\\u0E1A\\u0E01\\u0E32\\u0E23\\u0E0A\\u0E33\\u0E23\\u0E30\\u0E40\\u0E07\\u0E34\\u0E19\\u0E17\\u0E35\\u0E48\\u0E40\\u0E2B\\u0E21\\u0E32\\u0E30\\u0E01\\u0E31\\u0E1A\\u0E07\\u0E1A\\u0E1B\\u0E23\\u0E30\\u0E21\\u0E32\\u0E13\\u0E02\\u0E2D\\u0E07\\u0E04\\u0E38\\u0E13\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1140,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1138,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1137,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cart-card__body cart-card__body--payment\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"payment-options\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: `payment-pill${paymentMethod === 'cash' ? ' active' : ''}`,\n                onClick: () => setPaymentMethod('cash'),\n                children: \"\\u0E0A\\u0E33\\u0E23\\u0E30\\u0E40\\u0E15\\u0E47\\u0E21\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1145,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: `payment-pill${paymentMethod === 'installment' ? ' active' : ''}`,\n                onClick: () => setPaymentMethod('installment'),\n                children: \"\\u0E1C\\u0E48\\u0E2D\\u0E19\\u0E0A\\u0E33\\u0E23\\u0E30\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1152,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1144,\n              columnNumber: 15\n            }, this), paymentMethod === 'installment' && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"installment-picker\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"installmentPeriods\",\n                children: \"\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19\\u0E07\\u0E27\\u0E14\\u0E17\\u0E35\\u0E48\\u0E15\\u0E49\\u0E2D\\u0E07\\u0E01\\u0E32\\u0E23\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1162,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Form.Select, {\n                id: \"installmentPeriods\",\n                value: installmentPeriods,\n                onChange: event => setInstallmentPeriods(parseInt(event.target.value, 10)),\n                children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 2,\n                  children: \"2 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1168,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 3,\n                  children: \"3 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1169,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 4,\n                  children: \"4 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1170,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 5,\n                  children: \"5 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1171,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 6,\n                  children: \"6 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1172,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 7,\n                  children: \"7 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1173,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 8,\n                  children: \"8 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1174,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 9,\n                  children: \"9 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1175,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 10,\n                  children: \"10 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1176,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 11,\n                  children: \"11 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1177,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: 12,\n                  children: \"12 \\u0E07\\u0E27\\u0E14 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1178,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1163,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1161,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"summary-footer\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"summary-footer__info\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [\"\\u0E40\\u0E25\\u0E37\\u0E2D\\u0E01\\u0E41\\u0E25\\u0E49\\u0E27 \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: selectedCount\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1185,\n                    columnNumber: 31\n                  }, this), \" \\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1184,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"summary-footer__breakdown\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"summary-footer__row\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: \"\\u0E22\\u0E2D\\u0E14\\u0E23\\u0E27\\u0E21\\u0E2A\\u0E34\\u0E19\\u0E04\\u0E49\\u0E32\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1189,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: [\"\\u0E3F\", Math.round(subtotalExcludeVat).toLocaleString()]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1190,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1188,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"summary-footer__row\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: \"\\u0E04\\u0E48\\u0E32\\u0E08\\u0E31\\u0E14\\u0E2A\\u0E48\\u0E07\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1193,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: [\"\\u0E3F\", shippingFee.toLocaleString()]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1194,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1192,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"summary-footer__row\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: \"\\u0E20\\u0E32\\u0E29\\u0E35\\u0E21\\u0E39\\u0E25\\u0E04\\u0E48\\u0E32\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21 (7%)\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1197,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: [\"\\u0E3F\", Math.round(vatAmount).toLocaleString()]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1198,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1196,\n                    columnNumber: 21\n                  }, this), paymentMethod === 'installment' && /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"summary-footer__row\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: \"\\u0E08\\u0E33\\u0E19\\u0E27\\u0E19\\u0E07\\u0E27\\u0E14\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1202,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      children: [normalizedInstallmentPeriods, \" \\u0E40\\u0E14\\u0E37\\u0E2D\\u0E19\"]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1203,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1201,\n                    columnNumber: 23\n                  }, this), paymentMethod === 'installment' && /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"summary-footer__row summary-footer__row--total\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: \"\\u0E23\\u0E32\\u0E04\\u0E32\\u0E15\\u0E48\\u0E2D\\u0E07\\u0E27\\u0E14\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1208,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n                      children: [\"\\u0E3F\", roundedInstallmentAmount.toLocaleString()]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1209,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1207,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"summary-footer__row summary-footer__row--total\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: \"\\u0E22\\u0E2D\\u0E14\\u0E23\\u0E27\\u0E21\\u0E2A\\u0E38\\u0E17\\u0E18\\u0E34\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1213,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n                      children: [\"\\u0E3F\", Math.round(netTotal).toLocaleString()]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1214,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1212,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1187,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1183,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1182,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              className: \"summary-footer__button\",\n              onClick: handleSubmitOrder,\n              disabled: isSubmitDisabled,\n              children: isSubmitDisabled ? 'เลือกสินค้าเพื่อสั่งซื้อ' : 'ยืนยันคำสั่งซื้อ'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1219,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1143,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1136,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1024,\n        columnNumber: 9\n      }, this), submitAlert.show && /*#__PURE__*/_jsxDEV(Alert, {\n        variant: submitAlert.variant,\n        onClose: () => setSubmitAlert({\n          show: false,\n          variant: 'info',\n          message: ''\n        }),\n        dismissible: true,\n        className: \"summary-alert\",\n        children: submitAlert.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1231,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 897,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 896,\n    columnNumber: 5\n  }, this);\n}\n_s(Cart, \"miSk4HLws3QLvtNeFGctMFgMByQ=\", false, function () {\n  return [useNavigate];\n});\n_c = Cart;\nvar _c;\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"names":["React","useState","useEffect","useMemo","useNavigate","Container","Button","Form","Alert","axios","fetchCartItems","upsertCartItem","deleteCartItem","notifyCartUpdate","jsxDEV","_jsxDEV","Fragment","_Fragment","getItemKey","item","product_id","pricingType","createEmptyShipping","recipientName","recipientSurname","phone","address","splitFullName","fullName","first","last","parts","String","trim","split","filter","Boolean","length","slice","join","toCleanString","value","undefined","hasShippingValues","entry","Object","values","some","sanitizePhone","cleaned","replace","normalizeShippingEntry","base","trimmed","startsWith","JSON","parse","error","console","warn","summarizeRecipient","normalized","name","formatShippingPreview","lines","nameLine","push","INSTALLMENT_MIN_PERIODS","INSTALLMENT_MAX_PERIODS","DEFAULT_INSTALLMENT_PERIODS","clampInstallmentPeriods","numeric","Number","isFinite","Math","min","max","getInstallmentRateByMonths","months","calculateInstallmentTotalFromCash","cashPrice","price","rate","round","calculateInstallmentAmounts","totalAmount","periods","total","numPeriods","averagePerMonth","regularAmount","ceil","amounts","i","regularTotal","lastAmount","parseNumeric","number","resolveBestCashPrice","productData","fallbackPrice","_parseNumeric","fallback","cashPromo","price_cash_promo","cash","price_cash","Cart","_s","navigate","cart","setCart","productsData","setProductsData","paymentMethod","setPaymentMethod","installmentPeriods","setInstallmentPeriods","isSubmitting","setIsSubmitting","submitAlert","setSubmitAlert","show","variant","message","orderResult","setOrderResult","addressOptions","setAddressOptions","selectedAddressKey","setSelectedAddressKey","useCustomAddress","setUseCustomAddress","customShipping","setCustomShipping","defaultCustomShipping","setDefaultCustomShipping","selectedKeys","setSelectedKeys","currentUser","setCurrentUser","stored","localStorage","getItem","deriveCustomShippingSeed","profileData","primaryEntry","normalizedPrimary","normalizedCustomerAddress","customer_address","profileFallback","customer_fname","customer_lname","customer_tel","userFirstName","userLastName","currentUserFirstName","firstName","currentUserLastName","lastName","currentUserPhone","currentUserAddress","broadcastCartUpdate","data","options","getImageUrl","imagePath","p","encodedParts","map","part","encodeURIComponent","e","includes","pathToEncode","loadCart","loadAddressOptions","handleStorage","event","key","silent","storedUser","newValue","window","addEventListener","removeEventListener","syncUser","_event$detail","detail","user","prev","availableKeys","getPricingLabel","type","toLowerCase","syncCartState","items","preserveSelection","Array","isArray","_ref","_item$unitPrice","unitPrice","product_price","pricingLabel","filtered","productIds","loadProductsData","uniqueIds","Set","productsMap","Promise","all","productId","response","get","price_installment","price_installment_promo","getCashPrice","getInstallmentPrice","baseCashPrice","token","result","unauthorized","fallbackSeed","shippingProfile","shipping_profile","alternatives","alternativeAddresses","primary","defaultSeed","label","forEach","index","getSelectedAddressValue","option","find","updateQuantity","newQuantity","removeFromCart","target","quantity","mode","formatPriceValue","toLocaleString","shouldShowBasePrice","basePrice","promo","selectedItems","reduce","sum","shippingFee","vatRate","subtotalExcludeVat","vatAmount","netTotal","allSelected","selectedCount","isSubmitDisabled","normalizedInstallmentPeriods","toggleItemSelection","toggleSelectAll","installmentAmounts","roundedInstallmentAmount","highlightLabel","highlightAmount","handleSubmitOrder","setTimeout","shippingAddress","_response$data","_response$data2","itemPrice","post","createdOrderId","order_id","orderId","shipping_address","latestItems","_error$response","_error$response$data","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","fluid","style","whiteSpace","Check","checked","readOnly","itemKey","isSelected","hasPromo","parseFloat","showBasePrice","promoLabelClass","onChange","product_name","src","product_image","alt","Control","parseInt","Select","Group","Label","placeholder","as","rows","htmlFor","id","disabled","onClose","dismissible","_c","$RefreshReg$"],"sources":["D:/xampp/htdocs/Website_Sangswang/client/src/pages/Cart.js"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport Container from 'react-bootstrap/Container';\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport Alert from 'react-bootstrap/Alert';\nimport axios from 'axios';\nimport { fetchCartItems, upsertCartItem, deleteCartItem, notifyCartUpdate } from '../utils/cartApi';\nimport './Cart.css';\n\nconst getItemKey = (item) => `${item.product_id}-${item.pricingType || 'cash'}`;\n\nconst createEmptyShipping = () => ({\n  recipientName: '',\n  recipientSurname: '',\n  phone: '',\n  address: ''\n});\n\nconst splitFullName = (fullName) => {\n  if (!fullName) {\n    return { first: '', last: '' };\n  }\n  const parts = String(fullName)\n    .trim()\n    .split(/\\s+/)\n    .filter(Boolean);\n  if (parts.length === 0) {\n    return { first: '', last: '' };\n  }\n  if (parts.length === 1) {\n    return { first: parts[0], last: '' };\n  }\n  return { first: parts[0], last: parts.slice(1).join(' ') };\n};\n\nconst toCleanString = (value) => (value === undefined || value === null ? '' : String(value).trim());\n\nconst hasShippingValues = (entry) => {\n  if (!entry) {\n    return false;\n  }\n  return Object.values(entry).some((value) => toCleanString(value).length > 0);\n};\n\nconst sanitizePhone = (value) => {\n  const cleaned = toCleanString(value).replace(/\\D+/g, '');\n  return cleaned;\n};\n\nconst normalizeShippingEntry = (entry) => {\n  const base = createEmptyShipping();\n  if (!entry) {\n    return base;\n  }\n  if (typeof entry === 'string') {\n    const trimmed = entry.trim();\n    if (!trimmed) {\n      return base;\n    }\n    if (trimmed.startsWith('{')) {\n      try {\n        return normalizeShippingEntry(JSON.parse(trimmed));\n      } catch (error) {\n        console.warn('Failed to parse shipping entry JSON:', trimmed, error);\n        return { ...base, address: trimmed };\n      }\n    }\n    return { ...base, address: trimmed };\n  }\n  return {\n    recipientName: toCleanString(entry.recipientName),\n    recipientSurname: toCleanString(entry.recipientSurname),\n    phone: sanitizePhone(entry.phone),\n    address: toCleanString(entry.address)\n  };\n};\n\nconst summarizeRecipient = (entry) => {\n  const normalized = normalizeShippingEntry(entry);\n  const name = [normalized.recipientName, normalized.recipientSurname]\n    .filter(Boolean)\n    .join(' ')\n    .trim();\n  if (name && normalized.phone) {\n    return `${name} · ${normalized.phone}`;\n  }\n  if (name) {\n    return name;\n  }\n  if (normalized.phone) {\n    return normalized.phone;\n  }\n  return '';\n};\n\nconst formatShippingPreview = (entry) => {\n  const normalized = normalizeShippingEntry(entry);\n  const lines = [];\n  const nameLine = [normalized.recipientName, normalized.recipientSurname]\n    .filter(Boolean)\n    .join(' ')\n    .trim();\n  if (nameLine) {\n    lines.push(nameLine);\n  }\n    if (normalized.phone) {\n      lines.push(`เบอร์โทรสำหรับติดต่อ: ${normalized.phone}`);\n    }\n  if (normalized.address) {\n    lines.push(normalized.address);\n  }\n  return lines.join('\\n');\n};\n\nconst INSTALLMENT_MIN_PERIODS = 2;\nconst INSTALLMENT_MAX_PERIODS = 12;\nconst DEFAULT_INSTALLMENT_PERIODS = 12;\n\nconst clampInstallmentPeriods = (value) => {\n  const numeric = Number(value);\n  if (!Number.isFinite(numeric)) {\n    return INSTALLMENT_MIN_PERIODS;\n  }\n  return Math.min(Math.max(numeric, INSTALLMENT_MIN_PERIODS), INSTALLMENT_MAX_PERIODS);\n};\n\nconst getInstallmentRateByMonths = (months = DEFAULT_INSTALLMENT_PERIODS) => {\n  const normalized = clampInstallmentPeriods(months);\n  // 2 เดือน: 10%, 3-12 เดือน: เพิ่มขึ้นเรื่อยๆ จนถึง 12 เดือนที่ 20%\n  if (normalized === INSTALLMENT_MIN_PERIODS) {\n    return 0.1; // 2 เดือน = 10%\n  }\n  if (normalized >= INSTALLMENT_MAX_PERIODS) {\n    return 0.2; // 12 เดือน = 20%\n  }\n  // 3-11 เดือน: คำนวณแบบ linear จาก 10% ถึง 20%\n  // rate = 0.1 + (months - 2) * (0.2 - 0.1) / (12 - 2)\n  return 0.1 + (normalized - INSTALLMENT_MIN_PERIODS) * (0.2 - 0.1) / (INSTALLMENT_MAX_PERIODS - INSTALLMENT_MIN_PERIODS);\n};\n\nconst calculateInstallmentTotalFromCash = (cashPrice, months = DEFAULT_INSTALLMENT_PERIODS) => {\n  const price = Number(cashPrice);\n  if (!Number.isFinite(price) || price <= 0) {\n    return 0;\n  }\n  const rate = getInstallmentRateByMonths(months);\n  return Math.round(price * (1 + rate));\n};\n\n/**\n * คำนวณจำนวนเงินผ่อนชำระแต่ละงวดให้ถูกต้องตามหลักบัญชี\n * เดือนแรกถึงเดือนก่อนสุดท้าย: ปัดขึ้นเป็นหลักสิบ\n * เดือนสุดท้าย: เก็บเศษที่เหลือ (เพื่อให้รวมเท่ากับ totalAmount พอดี)\n */\nconst calculateInstallmentAmounts = (totalAmount, periods) => {\n  const total = Number(totalAmount);\n  const numPeriods = Number(periods);\n  \n  if (!Number.isFinite(total) || total <= 0 || !Number.isFinite(numPeriods) || numPeriods <= 0) {\n    return [];\n  }\n  \n  if (numPeriods === 1) {\n    return [total];\n  }\n  \n  // คำนวณจำนวนเงินต่อเดือนเฉลี่ย\n  const averagePerMonth = total / numPeriods;\n  \n  // ปัดขึ้นเป็นหลักสิบ (ceil to nearest 10)\n  const regularAmount = Math.ceil(averagePerMonth / 10) * 10;\n  \n  // เดือนแรกถึงเดือนก่อนสุดท้าย: ใช้ regularAmount\n  const amounts = [];\n  for (let i = 1; i < numPeriods; i++) {\n    amounts.push(regularAmount);\n  }\n  \n  // เดือนสุดท้าย: เก็บเศษที่เหลือ (เพื่อให้รวมเท่ากับ totalAmount พอดี)\n  const regularTotal = regularAmount * (numPeriods - 1);\n  const lastAmount = total - regularTotal;\n  amounts.push(lastAmount);\n  \n  return amounts;\n};\n\nconst parseNumeric = (value) => {\n  const number = Number(value);\n  return Number.isFinite(number) ? number : null;\n};\n\nconst resolveBestCashPrice = (productData, fallbackPrice = 0) => {\n  const fallback = parseNumeric(fallbackPrice) ?? 0;\n  if (!productData) {\n    return fallback;\n  }\n  const cashPromo = parseNumeric(productData.price_cash_promo);\n  const cash = parseNumeric(productData.price_cash);\n  if (cashPromo != null && cash != null && cashPromo < cash) {\n    return cashPromo;\n  }\n  if (cashPromo != null && cash == null) {\n    return cashPromo;\n  }\n  if (cash != null) {\n    return cash;\n  }\n  return fallback;\n};\n\nexport default function Cart() {\n  const navigate = useNavigate();\n  const [cart, setCart] = useState([]);\n  const [productsData, setProductsData] = useState({}); // เก็บข้อมูลสินค้าสำหรับหา price_cash\n  const [paymentMethod, setPaymentMethod] = useState('cash');\n  const [installmentPeriods, setInstallmentPeriods] = useState(6);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [submitAlert, setSubmitAlert] = useState({ show: false, variant: 'info', message: '' });\n  const [orderResult, setOrderResult] = useState(null);\n  const [addressOptions, setAddressOptions] = useState([]);\n  const [selectedAddressKey, setSelectedAddressKey] = useState('');\n  const [useCustomAddress, setUseCustomAddress] = useState(true);\n  const [customShipping, setCustomShipping] = useState(createEmptyShipping);\n  const [defaultCustomShipping, setDefaultCustomShipping] = useState(createEmptyShipping);\n  const [selectedKeys, setSelectedKeys] = useState([]);\n  const [currentUser, setCurrentUser] = useState(() => {\n    const stored = localStorage.getItem('user');\n    if (!stored) {\n      return null;\n    }\n    try {\n      return JSON.parse(stored);\n    } catch (error) {\n      console.warn('Failed to parse stored user:', error);\n      return null;\n    }\n  });\n\n  const deriveCustomShippingSeed = (profileData, primaryEntry) => {\n    const normalizedPrimary = primaryEntry ? normalizeShippingEntry(primaryEntry) : createEmptyShipping();\n    const normalizedCustomerAddress = normalizeShippingEntry(profileData?.customer_address);\n    const profileFallback = {\n      recipientName: toCleanString(profileData?.customer_fname),\n      recipientSurname: toCleanString(profileData?.customer_lname),\n      phone: sanitizePhone(profileData?.customer_tel),\n      address: normalizedCustomerAddress.address\n    };\n    const { first: userFirstName, last: userLastName } = splitFullName(currentUser?.name);\n    const currentUserFirstName =\n      toCleanString(currentUser?.firstName) || userFirstName;\n    const currentUserLastName =\n      toCleanString(currentUser?.lastName) || userLastName;\n    const currentUserPhone = sanitizePhone(currentUser?.phone);\n    const currentUserAddress = toCleanString(currentUser?.address);\n\n    return {\n      recipientName:\n        normalizedPrimary.recipientName ||\n        profileFallback.recipientName ||\n        currentUserFirstName,\n      recipientSurname:\n        normalizedPrimary.recipientSurname ||\n        profileFallback.recipientSurname ||\n        currentUserLastName,\n      phone: sanitizePhone(\n        normalizedPrimary.phone || profileFallback.phone || currentUserPhone\n      ),\n      address: normalizedPrimary.address || profileFallback.address || currentUserAddress\n    };\n  };\n\n  const broadcastCartUpdate = (data, options = {}) => {\n    notifyCartUpdate(data, options);\n  };\n\n  const getImageUrl = (imagePath) => {\n    if (!imagePath || imagePath.trim() === '') {\n      return 'https://via.placeholder.com/400?text=ไม่มีรูปภาพ';\n    }\n    const trimmed = String(imagePath).trim();\n    \n    // ถ้าเป็น URL แบบเต็ม (http:// หรือ https://) ให้ใช้ตามนั้น\n    if (trimmed.startsWith('http://') || trimmed.startsWith('https://')) {\n      return trimmed;\n    }\n    \n    // ดึงรูปภาพจากโฟลเดอร์ images โดยตรงผ่าน static file serving (ไม่ผ่าน API)\n    // ใช้ relative path เพื่อให้ React proxy ทำงาน\n    // สำหรับ path ที่มีอักขระภาษาไทย ต้อง encode แต่ละส่วนของ path\n    \n    // ถ้าเป็น path ที่เริ่มต้นด้วย / ให้ encode แต่ละส่วนของ path\n    if (trimmed.startsWith('/')) {\n      try {\n        // แยก path เป็นส่วนๆ และ encode แต่ละส่วน (ยกเว้น / หน้า)\n        const parts = trimmed.split('/').filter(p => p);\n        const encodedParts = parts.map(part => {\n          // Encode แต่ละส่วนของ path เพื่อให้ browser ส่งไปยัง server ถูกต้อง\n          try {\n            return encodeURIComponent(part);\n          } catch (e) {\n            return part;\n          }\n        });\n        return '/' + encodedParts.join('/');\n      } catch (e) {\n        return trimmed;\n      }\n    }\n    \n    // ถ้าเป็น path ปกติ ให้แปลงเป็น absolute path\n    if (trimmed.includes('/') || trimmed.includes('\\\\')) {\n      // แปลง backslash เป็น forward slash\n      const normalized = trimmed.replace(/\\\\/g, '/');\n      // ถ้าไม่มี / หน้า ให้เพิ่ม\n      const pathToEncode = normalized.startsWith('/') ? normalized : `/${normalized}`;\n      try {\n        const parts = pathToEncode.split('/').filter(p => p);\n        const encodedParts = parts.map(part => {\n          try {\n            return encodeURIComponent(part);\n          } catch (e) {\n            return part;\n          }\n        });\n        return '/' + encodedParts.join('/');\n      } catch (e) {\n        return pathToEncode;\n      }\n    }\n    \n    // ถ้าเป็นแค่ชื่อไฟล์ ให้ encode และใส่ใน /images/\n    try {\n      return `/images/${encodeURIComponent(trimmed)}`;\n    } catch (e) {\n      return `/images/${trimmed}`;\n    }\n  };\n\n  useEffect(() => {\n    loadCart();\n    loadAddressOptions();\n  }, []);\n\n  useEffect(() => {\n    const handleStorage = (event) => {\n      if (event.key === 'token') {\n        loadAddressOptions();\n        loadCart({ silent: true });\n      }\n      if (event.key === 'user') {\n        const storedUser = event.newValue;\n        if (storedUser) {\n          try {\n            setCurrentUser(JSON.parse(storedUser));\n          } catch (error) {\n            console.warn('Failed to parse user from storage event:', error);\n            setCurrentUser(null);\n          }\n        } else {\n          setCurrentUser(null);\n        }\n        loadAddressOptions();\n        loadCart({ silent: true });\n      }\n    };\n\n    window.addEventListener('storage', handleStorage);\n    return () => window.removeEventListener('storage', handleStorage);\n  }, []);\n\n  useEffect(() => {\n    const syncUser = (event) => {\n      if (event?.detail?.user !== undefined) {\n        setCurrentUser(event.detail.user);\n      } else {\n        const stored = localStorage.getItem('user');\n        if (stored) {\n          try {\n            setCurrentUser(JSON.parse(stored));\n          } catch (error) {\n            console.warn('Failed to parse stored user on sync:', error);\n            setCurrentUser(null);\n          }\n        } else {\n          setCurrentUser(null);\n        }\n      }\n      loadAddressOptions();\n    };\n\n    window.addEventListener('userChanged', syncUser);\n    return () => window.removeEventListener('userChanged', syncUser);\n  }, []);\n\n  useEffect(() => {\n    setSelectedKeys((prev) => {\n      if (prev.length === 0) {\n        return prev;\n      }\n      const availableKeys = cart.map((item) => getItemKey(item));\n      return prev.filter((key) => availableKeys.includes(key));\n    });\n  }, [cart]);\n\n  // ฟังก์ชันสำหรับแสดง pricing label\n  // ถ้าเป็นโปรโมชัน ให้แสดง \"โปรโมชัน\"\n  // ถ้าไม่มีโปรโมชัน ไม่ต้องแสดงอะไร\n  const getPricingLabel = (pricingType) => {\n    if (!pricingType) return '';\n    const type = String(pricingType).toLowerCase();\n    if (type.includes('promo')) {\n      return 'โปรโมชัน';\n    }\n    return '';\n  };\n\n  const syncCartState = (items, { preserveSelection = true, silent = false } = {}) => {\n    const normalized = Array.isArray(items)\n      ? items.map((item) => ({\n          ...item,\n          unitPrice: item.unitPrice ?? item.product_price ?? 0,\n          pricingType: item.pricingType || 'cash',\n          pricingLabel: getPricingLabel(item.pricingType || 'cash')\n        }))\n      : [];\n\n    setCart(normalized);\n    setSelectedKeys((prev) => {\n      const availableKeys = normalized.map((item) => getItemKey(item));\n      if (!preserveSelection || prev.length === 0) {\n        return availableKeys;\n      }\n      const filtered = prev.filter((key) => availableKeys.includes(key));\n      return filtered.length > 0 ? filtered : availableKeys;\n    });\n    broadcastCartUpdate(normalized, { silent });\n    \n    // ดึงข้อมูลสินค้าเพื่อหา price_cash เมื่อมีการเปลี่ยนแปลงตะกร้า\n    const productIds = normalized.map((item) => item.product_id);\n    if (productIds.length > 0) {\n      loadProductsData(productIds);\n    }\n  };\n\n  // ฟังก์ชันสำหรับดึงข้อมูลสินค้าเพื่อหา price_cash\n  const loadProductsData = async (productIds) => {\n    if (!productIds || productIds.length === 0) return;\n    \n    try {\n      const uniqueIds = [...new Set(productIds)];\n      const productsMap = {};\n      \n      // ดึงข้อมูลสินค้าแต่ละตัว\n      await Promise.all(\n        uniqueIds.map(async (productId) => {\n          try {\n            const response = await axios.get(`/api/products/${productId}`);\n            if (response.data) {\n              productsMap[productId] = {\n                price_cash: response.data.price_cash,\n                price_cash_promo: response.data.price_cash_promo,\n                price_installment: response.data.price_installment,\n                price_installment_promo: response.data.price_installment_promo\n              };\n            }\n          } catch (error) {\n            console.error(`Failed to fetch product ${productId}:`, error);\n          }\n        })\n      );\n      \n      setProductsData((prev) => ({ ...prev, ...productsMap }));\n    } catch (error) {\n      console.error('Failed to load products data:', error);\n    }\n  };\n\n  // ฟังก์ชันสำหรับหาราคาเงินสด (โปรโมชันก่อน ถ้าไม่มีใช้ราคาปกติ)\n  const getCashPrice = (item) => {\n    const productId = item.product_id;\n    const productData = productsData[productId];\n    return resolveBestCashPrice(productData, item.unitPrice);\n  };\n\n  // ฟังก์ชันสำหรับหาราคาแบบผ่อน (โปรโมชันก่อน ถ้าไม่มีใช้ราคาปกติ)\n  const getInstallmentPrice = (item) => {\n    const productId = item.product_id;\n    const productData = productsData[productId];\n    const baseCashPrice = resolveBestCashPrice(productData, item.unitPrice);\n    const periods = clampInstallmentPeriods(installmentPeriods);\n    return calculateInstallmentTotalFromCash(baseCashPrice, periods);\n  };\n\n  const loadCart = async ({ silent = true } = {}) => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      syncCartState([], { preserveSelection: false, silent });\n      return;\n    }\n    const result = await fetchCartItems();\n    if (result.unauthorized || result.error) {\n      syncCartState([], { preserveSelection: false, silent: true });\n      if (result.error) {\n        console.error('Failed to load cart items from server');\n      }\n      return;\n    }\n    syncCartState(result.items, { preserveSelection: false, silent });\n    \n    // ดึงข้อมูลสินค้าเพื่อหา price_cash\n    const productIds = result.items.map((item) => item.product_id);\n    if (productIds.length > 0) {\n      loadProductsData(productIds);\n    }\n  };\n\n  const loadAddressOptions = async () => {\n     const token = localStorage.getItem('token');\n     if (!token) {\n       setAddressOptions([]);\n       setSelectedAddressKey('custom');\n       setUseCustomAddress(true);\n      const fallbackSeed = deriveCustomShippingSeed();\n      setDefaultCustomShipping(fallbackSeed);\n      setCustomShipping((prev) => (hasShippingValues(prev) ? prev : fallbackSeed));\n      return;\n     }\n     try {\n       const response = await axios.get('/api/customer/profile');\n      const shippingProfile = response.data.shipping_profile || {};\n      const alternatives = Array.isArray(shippingProfile.alternatives)\n        ? shippingProfile.alternatives\n        : Array.isArray(response.data.alternativeAddresses)\n        ? response.data.alternativeAddresses\n        : [];\n      const primaryEntry = normalizeShippingEntry(shippingProfile.primary || response.data.customer_address);\n      const defaultSeed = deriveCustomShippingSeed(response.data, shippingProfile.primary || response.data.customer_address);\n      const options = [];\n      if (primaryEntry.address) {\n        options.push({\n          key: 'primary',\n          label: summarizeRecipient(primaryEntry)\n            ? `รายละเอียดที่อยู่ · ${summarizeRecipient(primaryEntry)}`\n            : 'รายละเอียดที่อยู่',\n          value: primaryEntry\n        });\n      }\n      alternatives.forEach((address, index) => {\n        const entry = normalizeShippingEntry(address);\n        if (!entry.address) {\n          return;\n        }\n        options.push({\n          key: `alt-${index}`,\n          label: summarizeRecipient(entry)\n            ? `ที่อยู่สำรอง ${index + 1} · ${summarizeRecipient(entry)}`\n            : `ที่อยู่สำรอง ${index + 1}`,\n          value: entry\n        });\n      });\n      setAddressOptions(options);\n      setDefaultCustomShipping(defaultSeed);\n      setCustomShipping((prev) => (hasShippingValues(prev) ? prev : defaultSeed));\n      if (options.length > 0) {\n        setSelectedAddressKey(options[0].key);\n        setUseCustomAddress(false);\n      } else {\n        setSelectedAddressKey('custom');\n        setUseCustomAddress(true);\n      }\n    } catch (error) {\n      console.error('Error loading profile addresses:', error);\n      setAddressOptions([]);\n      setSelectedAddressKey('custom');\n      setUseCustomAddress(true);\n      const fallbackSeed = deriveCustomShippingSeed();\n      setDefaultCustomShipping(fallbackSeed);\n      setCustomShipping((prev) => (hasShippingValues(prev) ? prev : fallbackSeed));\n    }\n  };\n\n  const getSelectedAddressValue = () => {\n     if (useCustomAddress || selectedAddressKey === 'custom') {\n      return normalizeShippingEntry(customShipping);\n    }\n    const option = addressOptions.find((item) => item.key === selectedAddressKey);\n    return option ? normalizeShippingEntry(option.value) : createEmptyShipping();\n  };\n\n  const updateQuantity = async (productId, pricingType, newQuantity) => {\n    if (newQuantity <= 0) {\n      await removeFromCart(productId, pricingType);\n      return;\n    }\n    const target = cart.find(\n      (item) => item.product_id === productId && item.pricingType === pricingType\n    );\n    if (!target) {\n      return;\n    }\n    const result = await upsertCartItem({\n      productId,\n      pricingType,\n      quantity: newQuantity,\n      unitPrice: target.unitPrice,\n      pricingLabel: target.pricingLabel,\n      mode: 'set'\n    });\n    if (result.unauthorized) {\n      navigate('/login');\n      return;\n    }\n    if (result.error) {\n      setSubmitAlert({\n        show: true,\n        variant: 'danger',\n        message: 'ไม่สามารถอัปเดตจำนวนสินค้าได้ กรุณาลองใหม่อีกครั้ง'\n      });\n      return;\n    }\n    syncCartState(result.items, { preserveSelection: true });\n  };\n\n  const removeFromCart = async (productId, pricingType) => {\n    const result = await deleteCartItem({ productId, pricingType });\n    if (result.unauthorized) {\n      navigate('/login');\n      return;\n    }\n    if (result.error) {\n      setSubmitAlert({\n        show: true,\n        variant: 'danger',\n        message: 'ไม่สามารถลบสินค้าออกจากตะกร้าได้ กรุณาลองใหม่อีกครั้ง'\n      });\n      return;\n    }\n    syncCartState(result.items, { preserveSelection: true });\n  };\n\nconst formatPriceValue = (value) => {\n  if (value == null) {\n    return '0';\n  }\n  const number = Number(value);\n  if (!Number.isFinite(number)) {\n    return '0';\n  }\n  return number.toLocaleString();\n};\n\nconst shouldShowBasePrice = (item) => {\n  if (!item) {\n    return false;\n  }\n  const pricingType = String(item.pricingType || '').toLowerCase();\n  if (!pricingType.includes('promo')) {\n    return false;\n  }\n  const base = Number(item.basePrice);\n  const promo = Number(item.unitPrice);\n  return Number.isFinite(base) && Number.isFinite(promo) && base > promo;\n};\n\n  const selectedItems = useMemo(\n    () => cart.filter((item) => selectedKeys.includes(getItemKey(item))),\n    [cart, selectedKeys]\n  );\n\n  // คำนวณยอดรวมโดยใช้ราคาตามวิธีการชำระเงิน\n  const total = useMemo(\n    () =>\n      selectedItems.reduce((sum, item) => {\n        const price =\n          paymentMethod === 'installment'\n            ? getInstallmentPrice(item)\n            : getCashPrice(item);\n        return sum + price * item.quantity;\n      }, 0),\n    [selectedItems, productsData, paymentMethod, installmentPeriods]\n  );\n\n  // ค่าจัดส่ง\n  const shippingFee = 0;\n\n  // คำนวณ VAT 7% - ราคาสินค้าที่ได้จากตะกร้าเป็นราคารวม VAT แล้ว\n  // ดังนั้นต้องแยกเป็นราคาก่อน VAT และ VAT\n  const vatRate = 0.07;\n  const subtotalExcludeVat = total / (1 + vatRate); // ราคารวมสินค้าก่อน VAT\n  const vatAmount = subtotalExcludeVat * vatRate; // จำนวน VAT 7%\n  const netTotal = subtotalExcludeVat + vatAmount + shippingFee; // ยอดรวมสุทธิ (ควรเท่ากับ total + shippingFee)\n\n  const allSelected = cart.length > 0 && selectedKeys.length === cart.length;\n  const selectedCount = selectedItems.length;\n  const isSubmitDisabled = selectedCount === 0 || isSubmitting;\n  const normalizedInstallmentPeriods = useMemo(\n    () => clampInstallmentPeriods(installmentPeriods),\n    [installmentPeriods]\n  );\n\n  const toggleItemSelection = (item) => {\n    const key = getItemKey(item);\n    setSelectedKeys((prev) =>\n      prev.includes(key) ? prev.filter((value) => value !== key) : [...prev, key]\n    );\n  };\n\n  const toggleSelectAll = () => {\n    if (allSelected) {\n      setSelectedKeys([]);\n    } else {\n      setSelectedKeys(cart.map((item) => getItemKey(item)));\n    }\n  };\n\n  // คำนวณจำนวนเงินแต่ละงวดให้ถูกต้องตามหลักบัญชี\n  const installmentAmounts = useMemo(() => {\n    if (normalizedInstallmentPeriods <= 0) {\n      return [];\n    }\n    return calculateInstallmentAmounts(netTotal, normalizedInstallmentPeriods);\n  }, [netTotal, normalizedInstallmentPeriods]);\n  \n  // ใช้จำนวนเงินงวดแรกเป็นราคาต่อเดือนสำหรับแสดงผล\n  const roundedInstallmentAmount = useMemo(() => {\n    if (!installmentAmounts || installmentAmounts.length === 0) {\n      return 0;\n    }\n    return installmentAmounts[0];\n  }, [installmentAmounts]);\n\n  const highlightLabel =\n    paymentMethod === 'installment'\n      ? `ค่างวดผ่อนโดยประมาณ (${normalizedInstallmentPeriods} งวด)`\n      : 'ยอดที่ต้องชำระ';\n  const highlightAmount =\n    paymentMethod === 'installment' ? roundedInstallmentAmount : netTotal;\n\n  const handleSubmitOrder = async () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setSubmitAlert({\n        show: true,\n        variant: 'warning',\n        message: 'กรุณาเข้าสู่ระบบก่อนส่งคำสั่งซื้อ'\n      });\n      setTimeout(() => navigate('/login'), 1200);\n      return;\n    }\n\n    if (selectedItems.length === 0) {\n      setSubmitAlert({\n        show: true,\n        variant: 'warning',\n        message: 'กรุณาเลือกสินค้าอย่างน้อย 1 รายการก่อนส่งคำสั่งซื้อ'\n      });\n      return;\n    }\n\n    const shippingAddress = normalizeShippingEntry(getSelectedAddressValue());\n    if (!shippingAddress.address) {\n      setSubmitAlert({\n        show: true,\n        variant: 'danger',\n        message: 'กรุณาเลือกหรือกรอกที่อยู่จัดส่งก่อนดำเนินการ'\n      });\n      return;\n    }\n\n    setIsSubmitting(true);\n    setSubmitAlert({ show: false, variant: 'info', message: '' });\n\n    try {\n      const periods = paymentMethod === 'installment' ? normalizedInstallmentPeriods : 1;\n      const items = selectedItems.map((item) => {\n        const itemPrice = paymentMethod === 'installment' \n          ? getInstallmentPrice(item) \n          : getCashPrice(item);\n        return {\n          product_id: item.product_id,\n          quantity: item.quantity,\n          price: itemPrice, // ใช้ราคาตามวิธีการชำระเงิน\n          pricingType: paymentMethod === 'installment' ? 'installment' : 'cash'\n        };\n      });\n\n      const response = await axios.post('/api/orders', {\n        items,\n        paymentMethod,\n        installmentPeriods: periods,\n        shippingAddress\n      });\n\n      const createdOrderId = response.data?.order_id;\n      setOrderResult({\n        orderId: createdOrderId,\n        total: netTotal,\n        paymentMethod,\n        periods,\n        shippingAddress: response.data?.shipping_address || shippingAddress\n      });\n\n      let latestItems = cart;\n      for (const item of selectedItems) {\n        const result = await deleteCartItem({\n          productId: item.product_id,\n          pricingType: item.pricingType || 'cash'\n        });\n        if (result.unauthorized) {\n          latestItems = [];\n          break;\n        }\n        if (!result.error) {\n          latestItems = result.items;\n        }\n      }\n\n      syncCartState(latestItems, { preserveSelection: false });\n      setCustomShipping(createEmptyShipping());\n      setSubmitAlert({\n        show: true,\n        variant: 'success',\n        message: 'ส่งคำสั่งซื้อเรียบร้อยแล้ว ระบบกำลังรอแอดมินอนุมัติ'\n      });\n    } catch (error) {\n      console.error('Submit order error:', error);\n      setSubmitAlert({\n        show: true,\n        variant: 'danger',\n        message: error.response?.data?.error || 'ส่งคำสั่งซื้อไม่สำเร็จ โปรดลองอีกครั้ง'\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (cart.length === 0) {\n    if (orderResult) {\n      return (\n        <div className=\"cart-page empty\">\n          <Container>\n            <div className=\"empty-cart success\">\n              <div className=\"empty-icon success\">\n                <i className=\"bi bi-hourglass-split\"></i>\n              </div>\n              <h2>คำสั่งซื้อถูกส่งเรียบร้อย</h2>\n              <p>\n                คำสั่งซื้อเลขที่ #{orderResult.orderId || '-'} อยู่ในสถานะ <strong>รออนุมัติ</strong>\n                <br />\n                {orderResult.shippingAddress && (\n                   <span>\n                    ที่อยู่จัดส่ง:\n                    <strong>\n                      <br />\n                      {formatShippingPreview(normalizeShippingEntry(orderResult.shippingAddress))}\n                    </strong>\n                    <br />\n                  </span>\n                )}\n                คุณสามารถติดตามความคืบหน้าได้ที่เมนู \"คำสั่งซื้อ\" และทีมงานจะติดต่อกลับทันทีเมื่อดำเนินการเสร็จสิ้น\n              </p>\n              <div className=\"success-actions\">\n                <Button className=\"btn-primary-custom\" onClick={() => navigate('/orders')}>\n                  ดูสถานะคำสั่งซื้อของฉัน\n                </Button>\n                <Button className=\"btn-outline\" onClick={() => navigate('/') }>\n                  กลับไปเลือกสินค้าเพิ่มเติม\n                </Button>\n              </div>\n            </div>\n          </Container>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"cart-page empty\">\n        <Container>\n          <div className=\"empty-cart\">\n            <div className=\"empty-icon\">\n              <i className=\"bi bi-bag\"></i>\n            </div>\n            <h2>ยังไม่มีสินค้าในตะกร้า</h2>\n            <p>เริ่มต้นเลือกสินค้าที่คุณชอบ แล้วกลับมาที่นี่อีกครั้ง</p>\n            <Button className=\"btn-primary-custom\" onClick={() => navigate('/') }>\n              ไปเลือกสินค้า\n            </Button>\n          </div>\n        </Container>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"cart-page\">\n      <Container fluid className=\"cart-container\">\n        <header className=\"cart-page__hero\">\n          <div className=\"cart-page__hero-text\">\n            <span className=\"cart-tagline\">\n              <i className=\"bi bi-cart-check\"></i>\n              ตะกร้าสินค้า\n            </span>\n            <h1>จัดการสินค้าและสรุปคำสั่งซื้อของคุณ</h1>\n            <p>\n              เลือกเฉพาะสินค้าที่ต้องการชำระในรอบนี้ แล้วระบุที่อยู่จัดส่งให้เรียบร้อย\n              <span style={{ whiteSpace: 'nowrap' }}>ทีมงานจะติดต่อกลับเพื่อสรุปรายละเอียดอย่างรวดเร็ว</span>\n            </p>\n          </div>\n          <Button className=\"btn-ghost\" onClick={() => navigate('/')}> \n            <i className=\"bi bi-plus-circle me-2\"></i>\n            เพิ่มสินค้า\n          </Button>\n        </header>\n\n        <section className=\"cart-card cart-card--items\">\n          <header className=\"cart-card__header\">\n            <div>\n              <h2>รายการสินค้า ({cart.length})</h2>\n              <p>เลือกรายการที่ต้องการชำระ แก้ไขจำนวน หรือนำออกได้ทันที</p>\n            </div>\n            <button type=\"button\" className=\"cart-select-all\" onClick={toggleSelectAll}>\n              <Form.Check type=\"checkbox\" checked={allSelected} readOnly />\n              <span>{allSelected ? 'ยกเลิกทั้งหมด' : 'เลือกทั้งหมด'}</span>\n            </button>\n          </header>\n\n          <div className=\"cart-items\">\n            {cart.map((item) => {\n              const itemKey = getItemKey(item);\n              const isSelected = selectedKeys.includes(itemKey);\n              const itemPrice = paymentMethod === 'installment' \n                ? getInstallmentPrice(item) \n                : getCashPrice(item);\n              const productData = productsData[item.product_id];\n              \n              // ตรวจสอบว่ามีโปรโมชันหรือไม่\n              let hasPromo = false;\n              let basePrice = null;\n              \n              if (paymentMethod === 'installment') {\n                hasPromo = productData && \n                  productData.price_installment_promo != null && \n                  productData.price_installment != null &&\n                  parseFloat(productData.price_installment_promo) < parseFloat(productData.price_installment);\n                basePrice = hasPromo ? parseFloat(productData.price_installment) : null;\n              } else {\n                hasPromo = productData && \n                  productData.price_cash_promo != null && \n                  productData.price_cash != null &&\n                  parseFloat(productData.price_cash_promo) < parseFloat(productData.price_cash);\n                basePrice = hasPromo ? parseFloat(productData.price_cash) : null;\n              }\n              \n              const showBasePrice = hasPromo;\n              const pricingLabel = hasPromo ? 'โปรโมชัน' : '';\n              const promoLabelClass = showBasePrice ? ' cart-item__label--promo' : '';\n              \n              return (\n                <article key={itemKey} className={`cart-item${isSelected ? ' cart-item--selected' : ''}`}>\n                  <div className=\"cart-item__select\">\n                    <Form.Check\n                      type=\"checkbox\"\n                      checked={isSelected}\n                      onChange={() => toggleItemSelection(item)}\n                      aria-label={`เลือก ${item.product_name}`}\n                    />\n                  </div>\n                  <img\n                    src={getImageUrl(item.product_image)}\n                    alt={item.product_name}\n                    className=\"cart-item__image\"\n                  />\n                  <div className=\"cart-item__info\">\n                    <h3>{item.product_name}</h3>\n                    <span className=\"cart-item__sku\">รหัสสินค้า #{item.product_id}</span>\n                    <div className=\"cart-item__meta\">\n                      {showBasePrice && basePrice != null && (\n                        <span className=\"cart-item__price cart-item__price--original\">\n                          ฿{formatPriceValue(basePrice)}\n                        </span>\n                      )}\n                      <span className=\"cart-item__price\">\n                        ฿{formatPriceValue(itemPrice)}\n                      </span>\n                      {pricingLabel && (\n                        <span className={`cart-item__label${promoLabelClass}`}>\n                          {pricingLabel}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"cart-item__controls\">\n                    <Form.Control\n                      type=\"number\"\n                      min=\"1\"\n                      value={item.quantity}\n                      onChange={(e) =>\n                        updateQuantity(\n                          item.product_id,\n                          item.pricingType,\n                          parseInt(e.target.value, 10)\n                        )\n                      }\n                    />\n                  </div>\n                  <div className=\"cart-item__total\">\n                    ฿{(itemPrice * item.quantity).toLocaleString()}\n                  </div>\n                  <button\n                    type=\"button\"\n                    className=\"cart-item__remove\"\n                    onClick={() => removeFromCart(item.product_id, item.pricingType)}\n                    aria-label={`ลบ ${item.product_name}`}\n                  >\n                    <i className=\"bi bi-x-lg\"></i>\n                  </button>\n                </article>\n              );\n            })}\n          </div>\n        </section>\n\n        <section className=\"cart-grid\">\n          <div className=\"cart-card\">\n            <header className=\"cart-card__header\">\n              <div>\n                <h2>เลือกที่อยู่จัดส่ง</h2>\n                <p>เลือกจากที่อยู่ที่บันทึกไว้ หรือระบุใหม่สำหรับคำสั่งซื้อนี้</p>\n              </div>\n            </header>\n            <div className=\"cart-card__body\">\n              {addressOptions.length > 0 ? (\n                 <>\n                   <Form.Select\n                     className=\"shipping-select\"\n                     value={useCustomAddress ? 'custom' : selectedAddressKey}\n                     onChange={(event) => {\n                       const value = event.target.value;\n                       if (value === 'custom') {\n                         setUseCustomAddress(true);\n                         setSelectedAddressKey('custom');\n                         setCustomShipping((prev) =>\n                           hasShippingValues(prev) ? prev : defaultCustomShipping\n                         );\n                       } else {\n                         setUseCustomAddress(false);\n                         setSelectedAddressKey(value);\n                       }\n                     }}\n                   >\n                     {addressOptions.map((option) => (\n                       <option key={option.key} value={option.key}>\n                         {option.label}\n                       </option>\n                     ))}\n                     <option value=\"custom\">ระบุที่อยู่ใหม่สำหรับออเดอร์นี้</option>\n                   </Form.Select>\n                   {!useCustomAddress && selectedAddressKey !== 'custom' && (\n                     <div className=\"shipping-preview\">\n                       {formatShippingPreview(getSelectedAddressValue())}\n                     </div>\n                   )}\n                 </>\n               ) : (\n                 <div className=\"shipping-note\">\n                   <i className=\"bi bi-geo\"></i>\n                   <span>ยังไม่มีที่อยู่ในบัญชี กรุณากรอกที่อยู่จัดส่งด้านล่าง</span>\n                 </div>\n               )}\n \n              {(useCustomAddress || addressOptions.length === 0) && (\n                <>\n                  <div className=\"shipping-custom-grid\">\n                    <Form.Group>\n                      <Form.Label>ชื่อผู้รับ</Form.Label>\n                      <Form.Control\n                        type=\"text\"\n                        value={customShipping.recipientName}\n                        onChange={(event) =>\n                          setCustomShipping((prev) => ({ ...prev, recipientName: event.target.value }))\n                        }\n                        placeholder=\"ชื่อจริงของผู้รับ\"\n                      />\n                    </Form.Group>\n                    <Form.Group>\n                      <Form.Label>นามสกุล</Form.Label>\n                      <Form.Control\n                        type=\"text\"\n                        value={customShipping.recipientSurname}\n                        onChange={(event) =>\n                          setCustomShipping((prev) => ({ ...prev, recipientSurname: event.target.value }))\n                        }\n                        placeholder=\"นามสกุลผู้รับ\"\n                      />\n                    </Form.Group>\n                    <Form.Group>\n                      <Form.Label>เบอร์โทรสำหรับติดต่อ</Form.Label>\n                      <Form.Control\n                        type=\"tel\"\n                        value={customShipping.phone}\n                        onChange={(event) =>\n                          setCustomShipping((prev) => ({\n                            ...prev,\n                            phone: sanitizePhone(event.target.value)\n                          }))\n                        }\n                        placeholder=\"เบอร์โทร\"\n                      />\n                    </Form.Group>\n                  </div>\n                  <Form.Control\n                    as=\"textarea\"\n                    rows={3}\n                    value={customShipping.address}\n                    onChange={(event) =>\n                      setCustomShipping((prev) => ({ ...prev, address: event.target.value }))\n                    }\n                    placeholder=\"เช่น 90/12 หมู่บ้านแสงสว่าง ซอยสุขสันต์ แขวงตลาด นนทบุรี 11000\"\n                    className=\"shipping-textarea\"\n                  />\n                </>\n              )}\n              <Button\n                type=\"button\"\n                variant=\"link\"\n                className=\"manage-address-link\"\n                onClick={() => navigate('/profile?tab=addresses')}\n              >\n                <i className=\"bi bi-pencil-square me-1\"></i>\n                จัดการที่อยู่จัดส่ง\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"cart-card\">\n            <header className=\"cart-card__header\">\n              <div>\n                <h2>วิธีการชำระเงิน</h2>\n                <p>เลือกรูปแบบการชำระเงินที่เหมาะกับงบประมาณของคุณ</p>\n              </div>\n            </header>\n            <div className=\"cart-card__body cart-card__body--payment\">\n              <div className=\"payment-options\">\n                <button\n                  type=\"button\"\n                  className={`payment-pill${paymentMethod === 'cash' ? ' active' : ''}`}\n                  onClick={() => setPaymentMethod('cash')}\n                >\n                  ชำระเต็มจำนวน\n                </button>\n                <button\n                  type=\"button\"\n                  className={`payment-pill${paymentMethod === 'installment' ? ' active' : ''}`}\n                  onClick={() => setPaymentMethod('installment')}\n                >\n                  ผ่อนชำระ\n                </button>\n              </div>\n              {paymentMethod === 'installment' && (\n                <div className=\"installment-picker\">\n                  <label htmlFor=\"installmentPeriods\">จำนวนงวดที่ต้องการ</label>\n                  <Form.Select\n                    id=\"installmentPeriods\"\n                    value={installmentPeriods}\n                    onChange={(event) => setInstallmentPeriods(parseInt(event.target.value, 10))}\n                  >\n                    <option value={2}>2 งวด </option>\n                    <option value={3}>3 งวด </option>\n                    <option value={4}>4 งวด </option>\n                    <option value={5}>5 งวด </option>\n                    <option value={6}>6 งวด </option>\n                    <option value={7}>7 งวด </option>\n                    <option value={8}>8 งวด </option>\n                    <option value={9}>9 งวด </option>\n                    <option value={10}>10 งวด </option>\n                    <option value={11}>11 งวด </option>\n                    <option value={12}>12 งวด </option>\n                  </Form.Select>\n                </div>\n              )}\n              <div className=\"summary-footer\">\n                <div className=\"summary-footer__info\">\n                  <span>\n                    เลือกแล้ว <strong>{selectedCount}</strong> รายการ\n                  </span>\n                  <div className=\"summary-footer__breakdown\">\n                    <div className=\"summary-footer__row\">\n                      <span>ยอดรวมสินค้า</span>\n                      <span>฿{Math.round(subtotalExcludeVat).toLocaleString()}</span>\n                    </div>\n                    <div className=\"summary-footer__row\">\n                      <span>ค่าจัดส่ง</span>\n                      <span>฿{shippingFee.toLocaleString()}</span>\n                    </div>\n                    <div className=\"summary-footer__row\">\n                      <span>ภาษีมูลค่าเพิ่ม (7%)</span>\n                      <span>฿{Math.round(vatAmount).toLocaleString()}</span>\n                    </div>\n                    {paymentMethod === 'installment' && (\n                      <div className=\"summary-footer__row\">\n                        <span>จำนวนงวด</span>\n                        <span>{normalizedInstallmentPeriods} เดือน</span>\n                      </div>\n                    )}\n                    {paymentMethod === 'installment' && (\n                      <div className=\"summary-footer__row summary-footer__row--total\">\n                        <span>ราคาต่องวด</span>\n                        <strong>฿{roundedInstallmentAmount.toLocaleString()}</strong>\n                      </div>\n                    )}\n                    <div className=\"summary-footer__row summary-footer__row--total\">\n                      <span>ยอดรวมสุทธิ</span>\n                      <strong>฿{Math.round(netTotal).toLocaleString()}</strong>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <Button\n                className=\"summary-footer__button\"\n                onClick={handleSubmitOrder}\n                disabled={isSubmitDisabled}\n              >\n                {isSubmitDisabled ? 'เลือกสินค้าเพื่อสั่งซื้อ' : 'ยืนยันคำสั่งซื้อ'}\n              </Button>\n            </div>\n          </div>\n        </section>\n\n        {submitAlert.show && (\n          <Alert\n            variant={submitAlert.variant}\n            onClose={() => setSubmitAlert({ show: false, variant: 'info', message: '' })}\n            dismissible\n            className=\"summary-alert\"\n          >\n            {submitAlert.message}\n          </Alert>\n        )}\n      </Container>\n    </div>\n  );\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}